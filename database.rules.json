{
  "rules": {
    "groups": {
      "$groupId": {
        ".read": "auth != null",
        ".write": "auth != null && (
          !data.exists() ||
          data.child('createdBy').val() === auth.uid ||
          data.child('members').child(auth.uid).exists()
        )",
        
        ".validate": "newData.hasChildren(['id', 'name', 'createdBy', 'createdAt'])",
        
        "name": {
          ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 100"
        },
        
        "description": {
          ".validate": "newData.isString() && newData.val().length <= 500"
        },
        
        "targetAmount": {
          ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 10000000"
        },
        
        "currency": {
          ".validate": "newData.isString() && newData.val().matches(/^[A-Z]{3}$/)"
        },
        
        "members": {
          "$memberId": {
            ".write": "auth != null && (
              $memberId === auth.uid ||
              root.child('groups').child($groupId).child('createdBy').val() === auth.uid
            )",
            
            "email": {
              ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 100"
            },
            
            "name": {
              ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 100"
            }
          }
        },
        
        "expenses": {
          "$expenseId": {
            ".write": "auth != null && root.child('groups').child($groupId).child('members').child(auth.uid).exists()",
            
            "description": {
              ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 500"
            },
            
            "amount": {
              ".validate": "newData.isNumber() && newData.val() > 0 && newData.val() <= 1000000"
            },
            
            "notes": {
              ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 1000)"
            }
          }
        },
        
        "settlements": {
          "$settlementId": {
            ".write": "auth != null && root.child('groups').child($groupId).child('members').child(auth.uid).exists()",
            
            "amount": {
              ".validate": "newData.isNumber() && newData.val() > 0 && newData.val() <= 1000000"
            },
            
            "notes": {
              ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 500)"
            }
          }
        },
        
        "recurringExpenses": {
          "$recurringId": {
            ".write": "auth != null && root.child('groups').child($groupId).child('members').child(auth.uid).exists()",
            
            "description": {
              ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 500"
            },
            
            "amount": {
              ".validate": "newData.isNumber() && newData.val() > 0 && newData.val() <= 1000000"
            }
          }
        },
        
        "budget": {
          "amount": {
            ".validate": "newData.isNumber() && newData.val() > 0 && newData.val() <= 10000000"
          }
        }
      }
    },
    
    "users": {
      "$userId": {
        ".read": "auth != null && auth.uid === $userId",
        ".write": "auth != null && auth.uid === $userId"
      }
    },
    
    "notifications": {
      "$userId": {
        ".read": "auth != null && auth.uid === $userId",
        ".write": "auth != null",
        ".indexOn": ["timestamp"],
        
        "$notificationId": {
          ".validate": "newData.hasChildren(['type', 'message', 'timestamp'])"
        }
      }
    },
    
    "fcmTokens": {
      "$userId": {
        ".read": "auth != null && auth.uid === $userId",
        ".write": "auth != null && auth.uid === $userId",
        
        "$tokenId": {
          ".validate": "newData.hasChildren(['token', 'createdAt', 'lastUsed'])"
        }
      }
    }
  }
}
