<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self'; 
        script-src 'self' 'unsafe-inline' 'unsafe-eval'; 
        style-src 'self' 'unsafe-inline'; 
        img-src 'self' data: https:; 
        connect-src 'self' http://127.0.0.1:8545 http://localhost:8545;
    ">
    <title>FundHub - Plataforma de Fondos Compartidos</title>
    <link rel="stylesheet" href="styles-platform.css">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
        <p id="loadingText">Cargando...</p>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Header -->
    <header class="app-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1>üí∞ FundHub</h1>
                    <span class="version-badge">Multi-Fund Platform</span>
                </div>
                
                <div class="header-actions">
                    <div id="userNickname" class="nickname-badge" style="display: none;">
                        <span class="nickname-icon">üë§</span>
                        <span id="nicknameDisplay"></span>
                    </div>
                    <button id="connectWallet" class="btn btn-primary">
                        <span class="btn-icon">ü¶ä</span>
                        <span>Conectar Wallet</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            
            <!-- Nickname Setup Modal (first time users) -->
            <div id="nicknameModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <h2>üëã ¬°Bienvenido a FundHub!</h2>
                    <p>Para comenzar, necesitas elegir un nickname √∫nico. Este nombre te identificar√° en todos tus fondos.</p>
                    
                    <div class="form-group">
                        <label for="nicknameInput">Tu Nickname</label>
                        <input 
                            type="text" 
                            id="nicknameInput" 
                            placeholder="Ej: Juan, Maria123, etc."
                            minlength="3"
                            maxlength="32"
                            pattern="[a-zA-Z0-9]+"
                        >
                        <small>3-32 caracteres, solo letras y n√∫meros</small>
                    </div>
                    
                    <button id="setNicknameBtn" class="btn btn-primary btn-block">
                        Establecer Nickname
                    </button>
                </div>
            </div>

            <!-- Dashboard Section -->
            <section id="dashboardSection" class="dashboard-section" style="display: none;">
                
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-content">
                            <h3 id="totalFundsCreated">0</h3>
                            <p>Fondos Creados</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-content">
                            <h3 id="totalFundsParticipating">0</h3>
                            <p>Fondos Participando</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">üíé</div>
                        <div class="stat-content">
                            <h3 id="totalValueLocked">0</h3>
                            <p>ETH Total</p>
                        </div>
                    </div>
                </div>

                <!-- Action Bar -->
                <div class="action-bar">
                    <h2>Mis Fondos</h2>
                    <button id="createFundBtn" class="btn btn-primary">
                        <span class="btn-icon">‚ûï</span>
                        <span>Crear Nuevo Fondo</span>
                    </button>
                </div>

                <!-- Fund Filters -->
                <div class="fund-filters">
                    <button class="filter-btn active" data-filter="all">
                        Todos (<span id="countAll">0</span>)
                    </button>
                    <button class="filter-btn" data-filter="created">
                        Creados (<span id="countCreated">0</span>)
                    </button>
                    <button class="filter-btn" data-filter="participating">
                        Participando (<span id="countParticipating">0</span>)
                    </button>
                    <button class="filter-btn" data-filter="travel">
                        üå¥ Viajes (<span id="countTravel">0</span>)
                    </button>
                    <button class="filter-btn" data-filter="savings">
                        üí∞ Ahorros (<span id="countSavings">0</span>)
                    </button>
                    <button class="filter-btn" data-filter="shared">
                        ü§ù Compartidos (<span id="countShared">0</span>)
                    </button>
                </div>

                <!-- Funds Grid -->
                <div id="fundsGrid" class="funds-grid">
                    <!-- Funds will be loaded here -->
                </div>

                <!-- Empty State -->
                <div id="emptyState" class="empty-state" style="display: none;">
                    <div class="empty-icon">üì¶</div>
                    <h3>No tienes fondos a√∫n</h3>
                    <p>Crea tu primer fondo para comenzar a organizar tus finanzas grupales</p>
                    <button class="btn btn-primary" onclick="document.getElementById('createFundBtn').click()">
                        Crear Mi Primer Fondo
                    </button>
                </div>

            </section>

            <!-- Fund Detail Section (Single Fund View) -->
            <section id="fundDetailSection" class="fund-detail-section" style="display: none;">
                
                <!-- Back Button -->
                <div class="back-bar">
                    <button id="backToDashboard" class="btn btn-secondary">
                        <span class="btn-icon">‚Üê</span>
                        <span>Volver a Mis Fondos</span>
                    </button>
                </div>

                <!-- Fund Header -->
                <div class="fund-detail-header">
                    <div class="fund-header-icon" id="fundHeaderIcon">üå¥</div>
                    <div class="fund-header-info">
                        <h1 id="fundDetailName">Cargando...</h1>
                        <p id="fundDetailDescription">-</p>
                        <div class="fund-badges">
                            <span class="badge" id="fundTypeBadge">Tipo</span>
                            <span class="badge" id="fundStatusBadge">Estado</span>
                            <span class="badge" id="fundPrivacyBadge">Privacidad</span>
                        </div>
                    </div>
                </div>

                <!-- Fund Stats Bar -->
                <div class="fund-stats-bar">
                    <div class="fund-stat-item">
                        <span class="stat-label">Balance</span>
                        <span class="stat-value" id="fundBalance">0 ETH</span>
                    </div>
                    <div class="fund-stat-item">
                        <span class="stat-label">Meta</span>
                        <span class="stat-value" id="fundTarget">0 ETH</span>
                    </div>
                    <div class="fund-stat-item">
                        <span class="stat-label">Progreso</span>
                        <span class="stat-value" id="fundProgress">0%</span>
                    </div>
                    <div class="fund-stat-item">
                        <span class="stat-label">Miembros</span>
                        <span class="stat-value" id="fundMembers">0</span>
                    </div>
                    <div class="fund-stat-item">
                        <span class="stat-label">Propuestas</span>
                        <span class="stat-value" id="fundProposals">0</span>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="progress-section">
                    <div class="progress-bar">
                        <div class="progress-fill" id="fundProgressBar" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Invitation Banner (if pending) -->
                <div id="invitationBanner" class="invitation-banner" style="display: none;">
                    <div class="invitation-content">
                        <span class="invitation-icon">üé´</span>
                        <p>Tienes una invitaci√≥n pendiente para este fondo</p>
                    </div>
                    <button id="acceptInvitationBtn" class="btn btn-primary">
                        Aceptar Invitaci√≥n
                    </button>
                </div>

                <!-- Fund Tabs -->
                <div class="fund-tabs">
                    <button class="fund-tab-btn active" data-tab="deposit">
                        <span class="tab-icon">üíµ</span>
                        <span>Depositar</span>
                    </button>
                    <button class="fund-tab-btn" data-tab="invite">
                        <span class="tab-icon">üé´</span>
                        <span>Invitar</span>
                    </button>
                    <button class="fund-tab-btn" data-tab="propose">
                        <span class="tab-icon">üìù</span>
                        <span>Proponer</span>
                    </button>
                    <button class="fund-tab-btn" data-tab="vote">
                        <span class="tab-icon">üó≥Ô∏è</span>
                        <span>Votar</span>
                    </button>
                    <button class="fund-tab-btn" data-tab="members">
                        <span class="tab-icon">üë•</span>
                        <span>Miembros</span>
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="fund-tab-content">
                    
                    <!-- Deposit Tab -->
                    <div id="depositTab" class="tab-pane active">
                        <div class="tab-card">
                            <h3>üí∞ Depositar Fondos</h3>
                            <p>Contribuye al fondo com√∫n. Tu aporte ser√° registrado en la blockchain.</p>
                            
                            <div class="form-group">
                                <label for="depositAmount">Monto a Depositar (ETH)</label>
                                <input type="number" id="depositAmount" placeholder="0.0" step="0.01" min="0.01">
                            </div>
                            
                            <div class="contribution-info">
                                <span>Tu contribuci√≥n actual: <strong id="userContribution">0 ETH</strong></span>
                            </div>
                            
                            <button id="depositBtn" class="btn btn-primary btn-block">
                                Depositar Fondos
                            </button>
                        </div>
                    </div>

                    <!-- Invite Tab -->
                    <div id="inviteTab" class="tab-pane">
                        <div class="tab-card">
                            <h3>üé´ Invitar Miembros</h3>
                            <p>Invita amigos para que se unan al fondo. Ellos deber√°n aceptar la invitaci√≥n.</p>
                            
                            <div class="form-group">
                                <label for="inviteAddress">Nickname o Direcci√≥n</label>
                                <input type="text" id="inviteAddress" placeholder="Ej: Bob o 0x123...">
                                <small>Ingresa el nickname del usuario o su direcci√≥n Ethereum</small>
                            </div>
                            
                            <button id="inviteBtn" class="btn btn-primary btn-block">
                                Enviar Invitaci√≥n
                            </button>
                        </div>
                    </div>

                    <!-- Propose Tab -->
                    <div id="proposeTab" class="tab-pane">
                        <div class="tab-card">
                            <h3>üìù Crear Propuesta</h3>
                            <p>Prop√≥n un gasto del fondo. Requiere aprobaci√≥n por votaci√≥n.</p>
                            
                            <div class="form-group">
                                <label for="proposalRecipient">Destinatario (Nickname o Direcci√≥n)</label>
                                <input type="text" id="proposalRecipient" placeholder="Ej: Bob o 0x123...">
                            </div>
                            
                            <div class="form-group">
                                <label for="proposalAmount">Monto (ETH)</label>
                                <input type="number" id="proposalAmount" placeholder="0.0" step="0.01" min="0.01">
                                <small>M√°ximo permitido: 80% del balance actual</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="proposalDescription">Descripci√≥n</label>
                                <textarea id="proposalDescription" rows="3" placeholder="Explica para qu√© es este gasto..."></textarea>
                            </div>
                            
                            <button id="createProposalBtn" class="btn btn-primary btn-block">
                                Crear Propuesta
                            </button>
                        </div>
                    </div>

                    <!-- Vote Tab -->
                    <div id="voteTab" class="tab-pane">
                        <h3>üó≥Ô∏è Propuestas Activas</h3>
                        <div id="proposalsList">
                            <!-- Proposals will be loaded here -->
                        </div>
                        <div id="noProposals" class="empty-state" style="display: none;">
                            <div class="empty-icon">üìã</div>
                            <h4>No hay propuestas activas</h4>
                            <p>Crea la primera propuesta para este fondo</p>
                        </div>
                    </div>

                    <!-- Members Tab -->
                    <div id="membersTab" class="tab-pane">
                        <h3>üë• Miembros del Fondo</h3>
                        <div id="membersList">
                            <!-- Members will be loaded here -->
                        </div>
                        <div id="noMembers" class="empty-state" style="display: none;">
                            <div class="empty-icon">üë§</div>
                            <h4>No hay miembros a√∫n</h4>
                        </div>
                    </div>

                </div>

            </section>

            <!-- Create Fund Modal -->
            <div id="createFundModal" class="modal" style="display: none;">
                <div class="modal-content modal-large">
                    <div class="modal-header">
                        <h2>‚ûï Crear Nuevo Fondo</h2>
                        <button class="modal-close" onclick="closeCreateFundModal()">&times;</button>
                    </div>
                    
                    <form id="createFundForm">
                        <!-- Fund Type Selection -->
                        <div class="form-group">
                            <label>Tipo de Fondo</label>
                            <div class="fund-type-grid">
                                <label class="fund-type-card">
                                    <input type="radio" name="fundType" value="0" checked>
                                    <div class="fund-type-content">
                                        <div class="fund-type-icon">üå¥</div>
                                        <h4>Viaje</h4>
                                        <p>Para vacaciones grupales</p>
                                    </div>
                                </label>
                                
                                <label class="fund-type-card">
                                    <input type="radio" name="fundType" value="1">
                                    <div class="fund-type-content">
                                        <div class="fund-type-icon">üí∞</div>
                                        <h4>Ahorro</h4>
                                        <p>Meta de ahorro compartido</p>
                                    </div>
                                </label>
                                
                                <label class="fund-type-card">
                                    <input type="radio" name="fundType" value="2">
                                    <div class="fund-type-content">
                                        <div class="fund-type-icon">ü§ù</div>
                                        <h4>Cuenta Compartida</h4>
                                        <p>Gastos recurrentes</p>
                                    </div>
                                </label>
                                
                                <label class="fund-type-card">
                                    <input type="radio" name="fundType" value="3">
                                    <div class="fund-type-content">
                                        <div class="fund-type-icon">üéØ</div>
                                        <h4>Otro</h4>
                                        <p>Prop√≥sito personalizado</p>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Fund Details -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="fundName">Nombre del Fondo *</label>
                                <input 
                                    type="text" 
                                    id="fundName" 
                                    placeholder="Ej: Viaje a Canc√∫n 2025"
                                    required
                                >
                            </div>
                            
                            <div class="form-group">
                                <label for="targetAmount">Meta (ETH) *</label>
                                <input 
                                    type="number" 
                                    id="targetAmount" 
                                    placeholder="10"
                                    step="0.01"
                                    min="0.01"
                                    required
                                >
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="fundDescription">Descripci√≥n</label>
                            <textarea 
                                id="fundDescription" 
                                rows="3"
                                placeholder="Describe el prop√≥sito del fondo..."
                            ></textarea>
                        </div>

                        <!-- Privacy Settings -->
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="isPrivate" checked>
                                <span>Fondo Privado (requiere invitaci√≥n)</span>
                            </label>
                            <small>Los fondos privados requieren que invites a cada participante</small>
                        </div>

                        <!-- Governance Settings -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="approvalPercentage">% de Aprobaci√≥n *</label>
                                <input 
                                    type="number" 
                                    id="approvalPercentage" 
                                    value="60"
                                    min="1"
                                    max="100"
                                    required
                                >
                                <small>Porcentaje de votos a favor necesario</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="minimumVotes">M√≠nimo de Votos *</label>
                                <input 
                                    type="number" 
                                    id="minimumVotes" 
                                    value="2"
                                    min="1"
                                    required
                                >
                                <small>Votos m√≠nimos para ejecutar propuesta</small>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="closeCreateFundModal()">
                                Cancelar
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <span class="btn-icon">üöÄ</span>
                                <span>Crear Fondo</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </main>

    <!-- Scripts -->
    <script src="ethers.umd.min.js"></script>
    <script src="app-platform.js"></script>
</body>
</html>
