<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8G443F7LPT"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('consent', 'default', {
            'analytics_storage': 'denied'
        });
        gtag('config', 'G-8G443F7LPT');
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self'; 
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://unpkg.com https://www.gstatic.com https://apis.google.com https://*.firebaseio.com https://www.googletagmanager.com https://*.google-analytics.com https://js.stripe.com;
        script-src-elem 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://unpkg.com https://www.gstatic.com https://apis.google.com https://*.firebaseio.com https://www.googletagmanager.com https://*.google-analytics.com https://js.stripe.com;
        style-src 'self' 'unsafe-inline'; 
        img-src 'self' data: https:; 
        media-src 'self' blob:;
        font-src 'self' https://fonts.gstatic.com;
        frame-src 'self' https://*.firebaseapp.com https://*.firebaseio.com https://accounts.google.com https://js.stripe.com https://checkout.stripe.com;
        connect-src 'self' http://127.0.0.1:8545 http://localhost:8545 https://*.base.org https://*.polygon.technology https://polygon-rpc.com https://*.basescan.org https://*.polygonscan.com wss://*.base.org wss://*.polygon.technology https://*.walletconnect.com wss://*.walletconnect.com https://cdn.jsdelivr.net https://*.coinbase.com https://chain-proxy.wallet.coinbase.com wss://*.walletlink.org https://*.walletlink.org https://www.gstatic.com https://*.firebaseio.com wss://*.firebaseio.com https://*.googleapis.com https://*.cloudfunctions.net https://identitytoolkit.googleapis.com https://securetoken.googleapis.com https://apis.google.com https://accounts.google.com https://api.exchangerate-api.com https://open.exchangerate-api.com https://api.openai.com https://www.googletagmanager.com https://*.google-analytics.com https://api.stripe.com;
    ">
    <title>Ant Pool - Cooperative Finance Colony</title>
    <meta name="description" content="Work together like ants. Track and organize shared expenses. Calculate splits and balances automatically. Your expense management tool.">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ant Pool">
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/favicon-96x96.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
    <link rel="stylesheet" href="styles-platform.css?v=3.0">
    <link rel="stylesheet" href="wallet-connector.css">
    <link rel="stylesheet" href="create-group-styles.css?v=2.0">
    <link rel="stylesheet" href="simple-mode-styles.css?v=2.2">
    <link rel="stylesheet" href="form-wizard-styles.css">
    <link rel="stylesheet" href="new-features-styles.css?v=1.2">
    <link rel="stylesheet" href="colony-styles.css?v=1.2">
    <link rel="stylesheet" href="mascot-styles.css?v=1.1">
    <link rel="stylesheet" href="subscription-styles.css?v=1.1">
    
    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <!-- QR Code Scanner -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    
    <!-- Stripe Pricing Table -->
    <script async src="https://js.stripe.com/v3/pricing-table.js"></script>
    
    <!-- Demo Mode System -->
    <script src="demo-mode.js?v=2.4"></script>
    
    <!-- Subscription Manager -->
    <script src="subscription-manager.js?v=1.0"></script>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <p id="loadingText" class="loading-text" data-i18n="app.loadingOverlay.loading">Cargando...</p>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- PWA Install Prompt -->
    <div id="pwaInstallPrompt" class="pwa-install-prompt" style="display: none;">
        <div class="pwa-install-content">
            <div class="pwa-install-icon">📱</div>
            <div class="pwa-install-text">
                <strong data-i18n="app.pwa.installTitle">Install Ant Pool</strong>
                <p data-i18n="app.pwa.installDesc">Get the full app experience with offline access</p>
            </div>
            <div class="pwa-install-actions">
                <button id="installPWAButton" class="btn btn-primary btn-sm">
                    <span data-i18n="app.pwa.installButton">Install</span>
                </button>
                <button id="dismissPWAPrompt" class="btn btn-ghost btn-sm">
                    <span data-i18n="app.pwa.dismissButton">×</span>
                </button>
            </div>
        </div>
    </div>

        <!-- Sign In Modal (for Simple Mode) -->
    <div id="signInModal" class="modal" style="display: none;">
        <div class="modal-content modal-auth">
            <button class="modal-close" onclick="closeSignInModal()">&times;</button>
            
            <div class="auth-container">
                <!-- Left Side - Branding -->
                <div class="auth-brand">
                    <div class="brand-content">
                        <div class="brand-icon"></div>
                        <h1 class="brand-title">Ant Pool</h1>
                        <p class="brand-subtitle" data-i18n="app.signIn.brandSubtitle">Track expenses with your team.
Simple, fast, and free.</p>
                        <div class="brand-features">
                            <div class="feature-item">
                                <span class="feature-icon"></span>
                                <span data-i18n="app.signIn.features.splitExpenses">Split expenses easily</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon"></span>
                                <span data-i18n="app.signIn.features.realTimeTracking">Real-time tracking</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon"></span>
                                <span data-i18n="app.signIn.features.securePrivate">Secure & private</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right Side - Sign In Form -->
                <div class="auth-form-container">
                    <div class="auth-form-content">
                        <h2 class="auth-title" data-i18n="app.signIn.getStarted">Get Started</h2>
                        <p class="auth-description" data-i18n="app.signIn.chooseMethod">Choose your preferred sign-in method</p>
                        
                        <!-- Main Sign In Options -->
                        <div id="mainSignInOptions" class="auth-options">
                            <button class="auth-btn auth-btn-google" onclick="signInWithGoogleOnly()">
                                <svg class="auth-btn-icon" viewBox="0 0 24 24" width="24" height="24">
                                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                                </svg>
                                <span class="auth-btn-text" data-i18n="app.signIn.continueWithGoogle">Continue with Google</span>
                            </button>
                            
                            <button class="auth-btn auth-btn-email" onclick="showEmailSignIn()">
                                <span class="auth-btn-icon"></span>
                                <span class="auth-btn-text" data-i18n="app.signIn.signInWithEmail">Sign in with Email</span>
                            </button>
                            
                            <!-- Advanced Options Toggle -->
                            <div class="auth-divider">
                                <span data-i18n="app.signIn.advancedOptions">Advanced Options</span>
                            </div>
                            
                            <details class="auth-advanced">
                                <summary class="auth-advanced-summary">
                                    <span class="advanced-icon"></span>
                                    <span class="advanced-text" data-i18n="app.signIn.blockchainMode">Blockchain Mode</span>
                                    <span class="advanced-badge" data-i18n="app.signIn.optional">Optional</span>
                                    <span class="advanced-arrow"></span>
                                </summary>
                                <div class="auth-advanced-content">
                                    <p class="advanced-description" data-i18n="app.signIn.blockchainDesc">
                                        Connect your MetaMask wallet for blockchain-based expense tracking and balance settlements.
                                    </p>
                                    <button class="auth-btn auth-btn-metamask" onclick="signInWithWallet()">
                                        <span class="auth-btn-icon"></span>
                                        <span class="auth-btn-text" data-i18n="app.signIn.connectMetaMask">Connect MetaMask</span>
                                    </button>
                                    <p class="advanced-note" data-i18n="app.signIn.requiresMetaMask">Requires MetaMask extension</p>
                                </div>
                            </details>
                        </div>
                        
                        <!-- Email Sign In Form (Hidden by default) -->
                        <div id="emailSignInForm" style="display: none;">
                            <form onsubmit="handleEmailSignIn(event)">
                                <div class="form-group">
                                    <label for="signInEmail" data-i18n="app.signIn.emailAddress">Email Address</label>
                                    <input type="email" id="signInEmail" class="input-modern" required data-i18n-placeholder="app.signIn.emailPlaceholder" placeholder="your@email.com">
                                </div>
                                <div class="form-group">
                                    <label for="signInPassword" data-i18n="app.signIn.password">Password</label>
                                    <input type="password" id="signInPassword" class="input-modern" required placeholder="">
                                </div>
                                <button type="submit" class="auth-btn auth-btn-primary" style="width: 100%;" data-i18n="app.signIn.signInButton">
                                    Sign In
                                </button>
                                <button type="button" class="btn btn-link" onclick="showCreateAccount()" data-i18n="app.signIn.createNewAccount">
                                    Create new account
                                </button>
                                <button type="button" class="btn btn-link" onclick="closeEmailSignIn()" data-i18n="app.signIn.backToOptions">
                                     Back to options
                                </button>
                            </form>
                        </div>
                        
                        <!-- Create Account Form (Hidden by default) -->
                        <div id="createAccountForm" style="display: none;">
                            <form onsubmit="handleCreateAccount(event)">
                                <div class="form-group">
                                    <label for="createName" data-i18n="app.signIn.displayName">Display Name</label>
                                    <input type="text" id="createName" class="input-modern" required data-i18n-placeholder="app.signIn.namePlaceholder" placeholder="Your Name">
                                </div>
                                <div class="form-group">
                                    <label for="createEmail" data-i18n="app.signIn.emailAddress">Email Address</label>
                                    <input type="email" id="createEmail" class="input-modern" required data-i18n-placeholder="app.signIn.emailPlaceholder" placeholder="your@email.com">
                                </div>
                                <div class="form-group">
                                    <label for="createPassword" data-i18n="app.signIn.password">Password</label>
                                    <input type="password" id="createPassword" class="input-modern" required minlength="6" data-i18n-placeholder="app.signIn.passwordPlaceholder" placeholder="Minimum 6 characters">
                                </div>
                                <button type="submit" class="auth-btn auth-btn-primary" style="width: 100%;" data-i18n="app.signIn.createAccount">
                                    Create Account
                                </button>
                                <button type="button" class="btn btn-link" onclick="showEmailSignIn()" data-i18n="app.signIn.backToSignIn">
                                     Back to Sign In
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
            </div>
        </div>
    </div>

    <!-- BETA Launch Banner Modal -->
    <div id="betaLaunchModal" class="modal-overlay" style="display: none;">
        <div class="beta-modal-content">
            <div class="beta-modal-header">
                <div class="beta-rocket">🚀</div>
                <h2 data-i18n="betaModal.welcome">Welcome to Ant Pool</h2>
                <p class="beta-subtitle" data-i18n="betaModal.subtitle">Launch Special Edition</p>
            </div>
            
            <div class="beta-modal-body">
                <div class="beta-announcement">
                    <div class="beta-icon">🎉</div>
                    <div class="beta-text">
                        <strong data-i18n="betaModal.allFree">All PRO features are FREE during launch!</strong>
                        <p data-i18n="betaModal.celebrating">We're celebrating our launch by giving everyone full access to premium features. Enjoy them while they last!</p>
                    </div>
                </div>
                
                <div class="beta-features-preview">
                    <h3 data-i18n="betaModal.featuresTitle">🐜 Features included FREE during BETA:</h3>
                    <div class="beta-features-grid">
                        <div class="beta-feature">
                            <span class="feature-icon">📊</span>
                            <span class="feature-name" data-i18n="betaModal.features.analytics">Advanced Analytics</span>
                            <span class="pro-tag">PRO</span>
                        </div>
                        <div class="beta-feature">
                            <span class="feature-icon">🔄</span>
                            <span class="feature-name" data-i18n="betaModal.features.recurring">Recurring Expenses</span>
                            <span class="pro-tag">PRO</span>
                        </div>
                        <div class="beta-feature">
                            <span class="feature-icon">💰</span>
                            <span class="feature-name" data-i18n="betaModal.features.budget">Budget Tracking</span>
                            <span class="pro-tag">PRO</span>
                        </div>
                        <div class="beta-feature">
                            <span class="feature-icon">📤</span>
                            <span class="feature-name" data-i18n="betaModal.features.export">Export Data (CSV)</span>
                            <span class="pro-tag">PRO</span>
                        </div>
                        <div class="beta-feature">
                            <span class="feature-icon">🎮</span>
                            <span class="feature-name" data-i18n="betaModal.features.minigames">All 7 Minigames</span>
                            <span class="pro-tag">PRO</span>
                        </div>
                        <div class="beta-feature">
                            <span class="feature-icon">👥</span>
                            <span class="feature-name" data-i18n="betaModal.features.members">Unlimited Members</span>
                            <span class="pro-tag">PRO</span>
                        </div>
                        <div class="beta-feature">
                            <span class="feature-icon">📁</span>
                            <span class="feature-name" data-i18n="betaModal.features.groups">Unlimited Groups</span>
                            <span class="pro-tag">PRO</span>
                        </div>
                        <div class="beta-feature">
                            <span class="feature-icon">🎁</span>
                            <span class="feature-name" data-i18n="betaModal.features.chests">Double Weekly Chests</span>
                            <span class="pro-tag">PRO</span>
                        </div>
                    </div>
                </div>
                
                <div class="beta-notice">
                    <span>⏰</span>
                    <span data-i18n="betaModal.notice">After the BETA period, some features will require a PRO subscription ($2.99/month). Early adopters may receive special discounts!</span>
                </div>
            </div>
            
            <div class="beta-modal-footer">
                <label class="beta-dont-show">
                    <input type="checkbox" id="betaDontShowAgain">
                    <span data-i18n="betaModal.dontShow">Don't show this again</span>
                </label>
                <button class="beta-continue-btn" onclick="closeBetaModal()">
                    <span data-i18n="betaModal.startBtn">🐜 Start Using Ant Pool</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="app-header">
        <div class="container">
            <div class="header-content">
                <!-- Logo Section -->
                <div class="logo" onclick="goToHome()" style="cursor: pointer;" title="Go to Home">
                    <h1>
                        <img src="/assets/LOGOAP_001.png" alt="Ant Pool" style="height: 36px; vertical-align: middle; margin-right: 10px;">
                        Ant Pool
                    </h1>
                    <span class="version-badge beta-version">🚀 BETA - All PRO features FREE!</span>
                </div>
                
                <!-- Header Actions Section -->
                <div class="header-actions">
                    <!-- Action Buttons Group -->
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <!-- BETA PRO Button - Shows all features are free -->
                        <button id="upgradeProBtn" class="upgrade-pro-btn beta-pro-btn" onclick="showBetaModal()" title="You have PRO access during BETA!">
                            <span>💎</span>
                            <span class="upgrade-text">PRO Active</span>
                            <span class="beta-mini-badge">BETA</span>
                        </button>
                        
                        <!-- Notifications -->
                        <button id="notificationsBtn" class="notifications-btn" onclick="toggleNotificationsPanel()" title="Notifications">
                            <span class="bell-icon">🔔</span>
                            <span id="notificationBadge" class="notification-badge hidden">0</span>
                        </button>
                        
                        <!-- Settings -->
                        <button class="settings-btn-app" onclick="openAppSettings()" title="Settings">⚙️</button>
                        
                        <!-- Unified User Menu Button -->
                        <div class="user-menu-container">
                            <button id="userMenuBtn" class="user-menu-btn" onclick="toggleUserMenu()" title="Account">
                                <div class="user-menu-avatar">
                                    <span id="userMenuIcon">👤</span>
                                </div>
                                <div class="user-menu-info">
                                    <div id="userMenuName" class="user-menu-name">Sign In</div>
                                    <div id="userMenuStatus" class="user-menu-status"></div>
                                </div>
                                <span class="user-menu-arrow">▼</span>
                            </button>
                            
                            <!-- Dropdown Menu -->
                            <div id="userMenuDropdown" class="user-menu-dropdown" style="display: none;">
                                <!-- Sign In Option (shown when not authenticated) -->
                                <div id="menuSignInOption" class="menu-section" style="display: none;">
                                    <button class="menu-item" onclick="showSignInModal(); closeUserMenu();">
                                        <span class="menu-icon">🔐</span>
                                        <div class="menu-content">
                                            <div class="menu-title" data-i18n="app.userMenu.signIn">Sign In</div>
                                            <div class="menu-desc" data-i18n="app.userMenu.accessSimpleMode">Access Simple Mode</div>
                                        </div>
                                    </button>
                                </div>
                                
                                <!-- User Info Section (shown when authenticated) -->
                                <div id="menuUserInfo" class="menu-section" style="display: none;">
                                    <div class="menu-header">
                                        <div class="menu-header-avatar">
                                            <span id="menuUserAvatar">👤</span>
                                        </div>
                                        <div class="menu-header-info">
                                            <div id="menuUserDisplayName" class="menu-header-name"></div>
                                            <div id="menuUserEmail" class="menu-header-email"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Wallet Info Section (shown when wallet connected) -->
                                <div id="menuWalletInfo" class="menu-section" style="display: none;">
                                    <div class="menu-item-static">
                                        <span class="menu-icon">🦊</span>
                                        <div class="menu-content">
                                            <div class="menu-title" data-i18n="app.userMenu.walletConnected">Wallet Connected</div>
                                            <div id="menuWalletAddress" class="menu-desc wallet-address"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="menu-divider"></div>
                                
                                <!-- Profile Option -->
                                <button id="myProfileBtn" class="menu-item" onclick="openProfilePanel(); closeUserMenu();">
                                    <span class="menu-icon">👤</span>
                                    <div class="menu-content">
                                        <div class="menu-title" data-i18n="app.userMenu.profile">My Profile</div>
                                    </div>
                                </button>
                                
                                <div class="menu-divider"></div>
                                
                                <!-- Sign Out Options -->
                                <div id="menuSignOutFirebase" class="menu-section" style="display: none;">
                                    <button id="signOutFirebase" class="menu-item menu-item-danger" onclick="signOutFromFirebase(); closeUserMenu();">
                                        <span class="menu-icon">🚪</span>
                                        <div class="menu-content">
                                            <div class="menu-title" data-i18n="app.userMenu.signOut">Sign Out</div>
                                            <div class="menu-desc">From Simple Mode</div>
                                        </div>
                                    </button>
                                </div>
                                
                                <div id="menuDisconnectWallet" class="menu-section" style="display: none;">
                                    <button id="disconnectWallet" class="menu-item menu-item-danger" onclick="closeUserMenu();">
                                        <span class="menu-icon">🔌</span>
                                        <div class="menu-content">
                                            <div class="menu-title" data-i18n="app.userMenu.disconnectWallet">Disconnect Wallet</div>
                                            <div class="menu-desc">From Blockchain Mode</div>
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Notification Banner (Main Page) -->
    <div id="notificationBanner" class="notification-banner hidden">
        <div class="notification-banner-content">
            <span class="notification-banner-icon">🔔</span>
            <span id="notificationBannerText" data-i18n="app.notifications.unreadBanner">You have unread notifications</span>
            <button class="notification-banner-btn" onclick="event.stopPropagation(); toggleNotificationsPanel();" data-i18n="app.notifications.view">View</button>
            <button class="notification-banner-close" onclick="event.stopPropagation(); closeNotificationBanner();">&times;</button>
        </div>
    </div>

    <!-- Notifications Panel -->
    <div id="notificationsPanel" class="notifications-panel hidden">
        <div class="notifications-header">
            <h3 data-i18n="app.notifications.title">🔔 Notifications</h3>
            <div class="notifications-header-actions">
                <button class="btn-text" onclick="markAllNotificationsAsRead()" id="markAllReadBtn" style="display: none;" data-i18n="app.notifications.markAllRead">Mark all as read</button>
                <button class="btn-text" onclick="deleteAllNotifications()" id="deleteAllBtn" title="Delete all notifications" data-i18n="app.notifications.deleteAll">🗑️</button>
                <button id="closeNotificationsBtn" class="btn-icon-close">&times;</button>
            </div>
        </div>
        <div id="emptyNotifications" class="empty-notifications hidden">
            <span class="empty-icon" data-i18n="app.notifications.empty">🔕</span>
            <p data-i18n="app.notifications.noNotifications">No notifications yet</p>
        </div>
        <div id="notificationsList" class="notifications-list">
        </div>
    </div>

    <!-- Profile Panel -->
    <div id="profilePanel" class="profile-panel hidden">
        <div class="profile-panel-overlay" onclick="closeProfilePanel()"></div>
        <div class="profile-panel-content">
            <!-- Header -->
            <div class="profile-header">
                <div class="profile-header-top">
                    <h2>👤 My Profile</h2>
                    <button class="btn-icon-close" onclick="closeProfilePanel()">&times;</button>
                </div>
                <div class="profile-user-info">
                    <div class="profile-avatar" id="profileAvatar">
                        <span id="profileAvatarText">U</span>
                    </div>
                    <div class="profile-details">
                        <h3 id="profileUserName">Not signed in</h3>
                        <p id="profileUserEmail">Please sign in to continue</p>
                        <div class="profile-badges">
                            <span class="profile-badge" id="profileAuthBadge">
                                <span class="badge-icon">🔐</span>
                                <span class="badge-text">Firebase Auth</span>
                            </span>
                            <span class="profile-badge" id="profileWalletBadge" style="display: none;">
                                <span class="badge-icon">🦊</span>
                                <span class="badge-text" id="profileWalletText">Not Connected</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Overview -->
            <div class="profile-stats">
                <div class="profile-stat-card">
                    <div class="stat-icon">👥</div>
                    <div class="stat-info">
                        <div class="stat-value" id="profileStatsGroups">0</div>
                        <div class="stat-label">Groups</div>
                    </div>
                </div>
                <div class="profile-stat-card">
                    <div class="stat-icon">💰</div>
                    <div class="stat-info">
                        <div class="stat-value" id="profileStatsExpenses">$0</div>
                        <div class="stat-label">Total Spent</div>
                    </div>
                </div>
                <div class="profile-stat-card">
                    <div class="stat-icon">🧾</div>
                    <div class="stat-info">
                        <div class="stat-value" id="profileStatsTransactions">0</div>
                        <div class="stat-label">Transactions</div>
                    </div>
                </div>
            </div>

            <!-- Tabs Navigation -->
            <div class="profile-tabs">
                <button class="profile-tab active" data-tab="overview" onclick="switchProfileTab('overview')">
                    <span>📊</span> <span data-i18n="app.profile.tabs.overview">Overview</span>
                </button>
                <button class="profile-tab" data-tab="groups" onclick="switchProfileTab('groups')">
                    <span>👥</span> <span data-i18n="app.profile.tabs.groups">Groups</span>
                </button>
                <button class="profile-tab" data-tab="subscription" onclick="switchProfileTab('subscription')">
                    <span>💎</span> <span data-i18n="app.profile.tabs.subscription">Plan</span>
                </button>
                <button class="profile-tab" data-tab="settings" onclick="switchProfileTab('settings')">
                    <span>⚙️</span> <span data-i18n="app.profile.tabs.settings">Settings</span>
                </button>
            </div>

            <!-- Tab Contents -->
            <div class="profile-tab-content">
                <!-- Overview Tab -->
                <div id="profileTabOverview" class="profile-tab-panel active">
                    <div class="profile-section">
                        <h4 data-i18n="app.profile.overview.accountInfo">Account Information</h4>
                        <div class="profile-info-grid">
                            <div class="profile-info-item">
                                <label data-i18n="app.profile.overview.email">Email</label>
                                <span id="profileInfoEmail">-</span>
                            </div>
                            <div class="profile-info-item">
                                <label data-i18n="app.profile.overview.memberSince">Member Since</label>
                                <span id="profileInfoMemberSince">-</span>
                            </div>
                            <div class="profile-info-item">
                                <label data-i18n="app.profile.overview.lastLogin">Last Login</label>
                                <span id="profileInfoLastLogin">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-section">
                        <h4 data-i18n="app.profile.overview.recentActivity">Recent Activity</h4>
                        <div id="profileRecentActivity" class="profile-activity-list">
                            <p class="empty-state-text" data-i18n="app.profile.overview.noActivity">No recent activity</p>
                        </div>
                    </div>
                </div>

                <!-- Groups Tab -->
                <div id="profileTabGroups" class="profile-tab-panel">
                    <div class="profile-section">
                        <div class="section-header">
                            <h4 data-i18n="app.profile.groups.title">My Groups</h4>
                            <button class="btn btn-sm btn-primary" onclick="closeProfilePanel(); document.getElementById('createFundBtn').click();">
                                <span>➕</span> <span data-i18n="app.profile.groups.newGroup">New Group</span>
                            </button>
                        </div>
                        <div id="profileGroupsList" class="profile-groups-list">
                            <p class="empty-state-text" data-i18n="app.profile.groups.empty">No groups yet</p>
                        </div>
                    </div>
                </div>

                <!-- Subscription Tab -->
                <div id="profileTabSubscription" class="profile-tab-panel">
                    <div class="profile-section">
                        <div class="subscription-header">
                            <h4 data-i18n="app.profile.subscription.title">🐜 Subscription Plans</h4>
                            <p data-i18n="app.profile.subscription.subtitle">Unlock premium features and support Ant Pool development</p>
                            
                            <!-- BETA Banner -->
                            <div class="subscription-beta-banner">
                                <span class="beta-icon">🚀</span>
                                <div class="beta-banner-text">
                                    <strong>BETA Launch Special!</strong>
                                    <span>All PRO features are currently FREE for everyone. Enjoy them while they last!</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="subscription-plans">
                            <!-- FREE Plan -->
                            <div id="freePlanCard" class="subscription-card free-plan">
                                <div class="plan-icon">🆓</div>
                                <h3 data-i18n="app.profile.subscription.free">Free</h3>
                                <div class="plan-price">
                                    <span class="price">$0</span>
                                    <span class="period" data-i18n="app.profile.subscription.perMonth">/month</span>
                                </div>
                                <p class="plan-description" data-i18n="app.profile.subscription.freeDesc">Perfect for getting started</p>
                                
                                <ul class="plan-features-list">
                                    <li class="feature-included"><span>✓</span> Up to 3 groups</li>
                                    <li class="feature-included"><span>✓</span> Up to 7 members per group</li>
                                    <li class="feature-included"><span>✓</span> Basic expense tracking</li>
                                    <li class="feature-included"><span>✓</span> Smart settlements</li>
                                    <li class="feature-included"><span>✓</span> 1 weekly chest</li>
                                    <li class="feature-included"><span>✓</span> 2 minigames</li>
                                    <li class="feature-excluded"><span>✗</span> Analytics & charts</li>
                                    <li class="feature-excluded"><span>✗</span> Recurring expenses</li>
                                    <li class="feature-excluded"><span>✗</span> Budget tracking</li>
                                    <li class="feature-excluded"><span>✗</span> Export data</li>
                                </ul>
                                
                                <div class="plan-footer">
                                    <span class="post-beta-label">After BETA</span>
                                </div>
                            </div>
                            
                            <!-- PRO Plan -->
                            <div id="proPlanCard" class="subscription-card pro-plan">
                                <div id="proPlanBadge" class="plan-badge current beta-active">🚀 ACTIVE (BETA FREE)</div>
                                <div class="plan-icon">💎</div>
                                <h3 data-i18n="app.profile.subscription.pro">PRO</h3>
                                <div class="plan-price">
                                    <span class="price">$2.99</span>
                                    <span class="period" data-i18n="app.profile.subscription.perMonth">/month</span>
                                </div>
                                <div class="plan-price-annual">
                                    <span data-i18n="app.profile.subscription.or">or</span> $29<span data-i18n="app.profile.subscription.perYear">/year</span> <span class="save-badge" data-i18n="app.profile.subscription.savePercent">Save 19%</span>
                                </div>
                                <p class="plan-description" data-i18n="app.profile.subscription.proDesc">Support development and get premium features</p>
                                
                                <ul class="plan-features-list">
                                    <li class="feature-included highlight"><span>✓</span> Unlimited groups</li>
                                    <li class="feature-included highlight"><span>✓</span> Unlimited members</li>
                                    <li class="feature-included"><span>✓</span> Everything in Free</li>
                                    <li class="feature-included highlight"><span>✓</span> 📊 Advanced analytics</li>
                                    <li class="feature-included highlight"><span>✓</span> 🔄 Recurring expenses</li>
                                    <li class="feature-included highlight"><span>✓</span> 💰 Budget tracking</li>
                                    <li class="feature-included highlight"><span>✓</span> 📤 Export to CSV</li>
                                    <li class="feature-included highlight"><span>✓</span> 🎁 2 weekly chests</li>
                                    <li class="feature-included highlight"><span>✓</span> 🎮 All 7 minigames</li>
                                    <li class="feature-included"><span>✓</span> No watermarks</li>
                                </ul>
                                
                                <div class="plan-footer beta-footer">
                                    <span class="beta-free-now">✨ FREE during BETA!</span>
                                    <span class="post-beta-price">$2.99/mo after launch</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="subscription-footer">
                            <p data-i18n="app.profile.subscription.earlyAdopter">💡 Early adopters may receive lifetime discounts when PRO launches!</p>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="profileTabSettings" class="profile-tab-panel">
                    <div class="profile-section">
                        <h4 data-i18n="app.profile.settings.preferences">Preferences</h4>
                        <div class="settings-list">
                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-label" data-i18n="app.profile.settings.darkMode">🌙 Dark Mode</div>
                                    <div class="setting-description" data-i18n="app.profile.settings.darkModeDesc">Toggle dark theme</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="settingDarkMode" onchange="toggleDarkModeSetting(this)">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-label" data-i18n="app.profile.settings.pushNotifications">🔔 Push Notifications</div>
                                    <div class="setting-description" data-i18n="app.profile.settings.pushNotificationsDesc">Get alerts on your device</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="settingPushNotifications" onchange="togglePushNotifications(this)">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-label" data-i18n="app.profile.settings.inAppNotifications">🔔 In-App Notifications</div>
                                    <div class="setting-description" data-i18n="app.profile.settings.inAppNotificationsDesc">Show notification panel</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="settingNotifications" checked onchange="toggleNotificationsSetting(this)">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="profile-section">
                        <h4 data-i18n="app.profile.settings.accountActions">Account Actions</h4>
                        <div class="action-buttons">
                            <button class="btn btn-secondary btn-block" onclick="closeProfilePanel(); openAppSettings();" data-i18n="app.profile.settings.appSettings">
                                ⚙️ App Settings
                            </button>
                            <button class="btn btn-secondary btn-block" onclick="exportUserData();" data-i18n="app.profile.settings.exportData">
                                📥 Export My Data
                            </button>
                            <button class="btn btn-danger btn-block" onclick="confirmSignOut();" data-i18n="app.profile.settings.signOut">
                                🚪 Sign Out
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="appSettingsModal" class="modal-overlay" onclick="closeAppSettings(event)">
        <div class="settings-modal" onclick="event.stopPropagation()">
            <div class="settings-header">
                <h2><span class="settings-emoji">⚙️</span> <span class="settings-title-text">Settings</span></h2>
                <button class="close-btn" onclick="closeAppSettings()">&times;</button>
            </div>
            <div class="settings-content">
                <!-- Language Selection -->
                <div class="setting-group">
                    <label>🌍 Language</label>
                    <div class="setting-options">
                        <button class="setting-option" data-lang="en" onclick="changeLanguage('en')">
                            <span class="option-flag">🇺🇸</span>
                            <span>English</span>
                            <span class="option-check">✓</span>
                        </button>
                        <button class="setting-option" data-lang="es" onclick="changeLanguage('es')">
                            <span class="option-flag">🇪🇸</span>
                            <span>Español</span>
                            <span class="option-check">✓</span>
                        </button>
                    </div>
                </div>

                <!-- Theme Selection -->
                <div class="setting-group">
                    <label>🎨 Theme</label>
                    <div class="setting-options">
                        <button class="setting-option" data-theme="light" onclick="changeTheme('light')">
                            <span class="option-icon">☀️</span>
                            <span>Light Mode</span>
                            <span class="option-check">✓</span>
                        </button>
                        <button class="setting-option" data-theme="dark" onclick="changeTheme('dark')">
                            <span class="option-icon">🌙</span>
                            <span>Dark Mode</span>
                            <span class="option-check">✓</span>
                        </button>
                    </div>
                </div>

                <!-- Haptic Feedback -->
                <div class="setting-group">
                    <label>📳 Feedback</label>
                    <div class="setting-options">
                        <button class="setting-option" id="hapticToggle" onclick="toggleHapticFeedback()">
                            <span class="option-icon">📳</span>
                            <span data-i18n="app.settings.vibration">Vibración</span>
                            <span class="option-check toggle-check" id="hapticCheck">✓</span>
                        </button>
                        <button class="setting-option" id="soundToggle" onclick="toggleSoundFeedback()">
                            <span class="option-icon">🔊</span>
                            <span data-i18n="app.settings.sound">Sonidos</span>
                            <span class="option-check toggle-check" id="soundCheck">✓</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Colony Weekly Chest Modal -->
    <div id="weeklyChestModal" class="modal-overlay" onclick="if(typeof ColonySystem !== 'undefined') ColonySystem.closeChestModal(event)" style="display: none;">
        <div class="weekly-chest-modal" onclick="event.stopPropagation()">
            <div class="chest-modal-content">
                <!-- Content will be injected by ColonySystem -->
            </div>
        </div>
    </div>

    <!-- QR Scanner Modal -->
    <div id="qrScannerModal" class="modal" style="display: none;">
        <div class="modal-content qr-scanner-modal">
            <div class="modal-header">
                <h3 id="qrScannerTitle">📷 Scan QR Code</h3>
                <button class="modal-close" id="closeQRScannerBtn1">&times;</button>
            </div>
            
            <div class="warning-box qr-warning">
                <p><strong id="qrWarningTitle">⚠️ IMPORTANT - Read carefully:</strong></p>
                <ul id="qrWarningList">
                    <li><strong>Base Network Only:</strong> The address MUST be a valid address on the <strong>Base blockchain</strong></li>
                    <li><strong>Verify carefully:</strong> If you send funds to an incorrect address, <strong>they will be lost forever</strong></li>
                    <li><strong>No refunds:</strong> Blockchain transactions are irreversible</li>
                    <li><strong>Your responsibility:</strong> Double-check that the address belongs to the intended recipient</li>
                </ul>
            </div>
            
            <div id="qrReader" class="qr-reader"></div>
            
            <div id="qrScanResult" style="display: none;">
                <div class="scan-result-box">
                    <p><strong id="qrDetectedLabel">✅ Address detected:</strong></p>
                    <div class="address-display">
                        <code id="scannedAddress"></code>
                    </div>
                </div>
                
                <div class="warning-box critical-warning">
                    <p><strong id="qrFinalConfirmTitle">🚨 FINAL CONFIRMATION</strong></p>
                    <p id="qrConfirmationText">By clicking "Confirm", you declare that:</p>
                    <ul id="qrConfirmationList">
                        <li>This address is correct and belongs to the intended recipient</li>
                        <li>This address is on the <strong>Base blockchain</strong></li>
                        <li>You understand that funds sent to an incorrect address <strong>cannot be recovered</strong></li>
                        <li>You assume full responsibility for this address</li>
                    </ul>
                    
                    <label class="checkbox-label">
                        <input type="checkbox" id="qrConfirmCheckbox">
                        <span id="qrCheckboxLabel">I have verified the address and accept full responsibility</span>
                    </label>
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="qrCancelBtn2">Cancel</button>
                    <button id="confirmQRBtn" class="btn btn-primary" disabled>
                        ✓ Confirm and Use Address
                    </button>
                </div>
            </div>
            
            <button id="cancelScanBtn" class="btn btn-secondary btn-block">
                Cancel Scan
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            
            <!-- Nickname Setup Modal (first time users) -->
            <div id="nicknameModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <h2 data-i18n="app.nickname.title">👋 Welcome to Ant Pool!</h2>
                    <p data-i18n="app.nickname.subtitle">Share expenses simply or use blockchain for automatic payments. <strong>No wallet needed to start.</strong></p>
                    <p data-i18n="app.nickname.firstSet">First, set a <strong>nickname</strong> to identify yourself in groups.</p>
                    
                    <div class="form-group">
                        <label for="nicknameInput" data-i18n="app.nickname.label">Your Nickname *</label>
                        <input 
                            type="text" 
                            id="nicknameInput" 
                            data-i18n-placeholder="app.nickname.placeholder"
                            placeholder="Ex: John, Maria123, etc."
                            minlength="3"
                            maxlength="32"
                            pattern="[a-zA-Z0-9]+"
                            required
                        >
                        <small data-i18n="app.nickname.help">3-32 characters, letters and numbers only. It will identify you in all your groups.</small>
                    </div>
                    
                    <button id="setNicknameBtn" class="btn btn-primary btn-block" data-i18n="app.nickname.button">
                        Set Nickname and Continue
                    </button>
                </div>
            </div>

            <!-- Dashboard Section -->
            <section id="dashboardSection" class="dashboard-section">
                
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">📊</div>
                        <div class="stat-content">
                            <h3 id="totalGroupsCreated">0</h3>
                            <p data-i18n="app.stats.groupsCreated">Groups Created</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">👥</div>
                        <div class="stat-content">
                            <h3 id="totalGroupsParticipating">0</h3>
                            <p data-i18n="app.stats.activeGroups">Active Groups</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">🎉</div>
                        <div class="stat-content">
                            <h3 id="totalGroupsJoined">0</h3>
                            <p data-i18n="app.stats.groupsJoined">Groups Joined</p>
                        </div>
                    </div>
                </div>

                <!-- Personal Colony Dashboard (shown when user has personal expenses) -->
                <div id="personalDashboard" class="personal-dashboard" style="display: none;">
                    <div class="personal-dashboard-header">
                        <span class="personal-dashboard-title">
                            🐜 <span data-i18n="app.personalColony.title">My Personal Colony</span>
                        </span>
                        <span class="personal-dashboard-month" id="personalDashboardMonth"></span>
                    </div>
                    
                    <div class="personal-stat-grid">
                        <div class="personal-stat">
                            <div class="personal-stat-value" id="personalTotalSpent">€0</div>
                            <div class="personal-stat-label" data-i18n="app.personalColony.stats.totalSpent">This Month</div>
                        </div>
                        <div class="personal-stat">
                            <div class="personal-stat-value" id="personalExpenseCount">0</div>
                            <div class="personal-stat-label" data-i18n="app.personalColony.stats.transactions">Transactions</div>
                        </div>
                        <div class="personal-stat">
                            <div class="personal-stat-category">
                                <span class="personal-stat-category-icon" id="personalTopCategoryIcon">🍕</span>
                                <span id="personalTopCategoryName" data-i18n="app.categories.food">Food</span>
                            </div>
                            <div class="personal-stat-label" data-i18n="app.personalColony.stats.topCategory">Top Category</div>
                        </div>
                        <div class="personal-stat">
                            <div class="personal-stat-value" id="personalAvgExpense">€0</div>
                            <div class="personal-stat-label" data-i18n="app.personalColony.stats.avgExpense">Avg/Expense</div>
                        </div>
                    </div>
                    
                    <div class="budget-section" id="personalBudgetSection">
                        <div id="budgetDisplay" style="display: none;">
                            <div class="budget-header">
                                <span class="budget-label" data-i18n="app.personalColony.budget.monthlyBudget">Monthly Budget</span>
                                <span class="budget-amount" id="personalBudgetAmount">€0 / €500</span>
                            </div>
                            <div class="budget-bar">
                                <div class="budget-fill" id="personalBudgetFill" style="width: 0%"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                                <span id="personalBudgetTrend" class="trend-indicator trend-neutral">→ 0%</span>
                                <button class="fab-link-btn" onclick="openPersonalBudgetModal()" data-i18n="app.personalColony.budget.edit">Edit Budget</button>
                            </div>
                        </div>
                        <button id="setBudgetBtn" class="budget-set-btn" onclick="openPersonalBudgetModal()" style="display: flex;">
                            <span>📊</span>
                            <span data-i18n="app.personalColony.budget.setMonthly">Set Monthly Budget</span>
                        </button>
                    </div>
                    
                    <button class="btn-link" onclick="viewPersonalColony()" style="margin-top: 1rem; width: 100%; text-align: center; color: #10b981; font-weight: 500;" data-i18n="app.personalColony.viewAll">
                        View All Personal Expenses →
                    </button>
                </div>

                <!-- Pending Invitations Banner -->
                <div id="pendingInvitationsSection" class="pending-invitations-section" style="display: none;">
                    <div class="invitations-header">
                        <h3 data-i18n="app.invitations.title">🎫 Pending Invitations</h3>
                        <span class="invitations-count" id="invitationsCount">0</span>
                    </div>
                    <div id="invitationsList" class="invitations-list">
                        <!-- Invitations will be loaded here -->
                    </div>
                </div>

                <!-- Action Bar -->
                <div class="action-bar">
                    <h2 data-i18n="app.dashboard.title">My Groups</h2>
                    <button id="createFundBtn" class="btn" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.875rem 1.25rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 10px; cursor: pointer; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.35); transition: all 0.2s ease;" title="Create a new expense group">
                        <span style="font-size: 1.1rem; background: rgba(255,255,255,0.2); padding: 0.4rem; border-radius: 6px; line-height: 1;">✨</span>
                        <span style="display: flex; flex-direction: column; align-items: flex-start; gap: 0.1rem;">
                            <strong style="color: #ffffff !important; font-weight: 600; font-size: 0.9rem; -webkit-text-fill-color: #ffffff;" data-i18n="app.dashboard.createButton">Create New Group</strong>
                            <small style="color: rgba(255,255,255,0.85) !important; font-size: 0.7rem; -webkit-text-fill-color: rgba(255,255,255,0.85);" data-i18n="app.dashboard.createTapHere">Tap here to start</small>
                        </span>
                    </button>
                </div>

                <!-- Fund Filters -->
                <div class="fund-filters">
                    <button class="filter-btn active" data-filter="all">
                        <span data-i18n="app.dashboard.filters.all">📋 All</span> (<span id="countAll">0</span>)
                    </button>
                    <button class="filter-btn" data-filter="created">
                        <span data-i18n="app.dashboard.filters.created">👑 Created by me</span> (<span id="countCreated">0</span>)
                    </button>
                    <button class="filter-btn" data-filter="participating">
                        <span data-i18n="app.dashboard.filters.participating">👥 Member of</span> (<span id="countParticipating">0</span>)
                    </button>
                </div>

                <!-- Search and Sort Bar -->
                <div class="search-sort-bar">
                    <div class="search-box-container">
                        <input 
                            type="text" 
                            id="groupSearchInput" 
                            class="search-input" 
                            data-i18n-placeholder="app.dashboard.searchPlaceholder"
                            placeholder="🔍 Search groups by name..."
                            onkeyup="filterAndSortGroups()"
                        />
                    </div>
                    <div class="sort-controls">
                        <label for="sortOrder" class="sort-label" data-i18n="app.dashboard.sortBy">Sort by:</label>
                        <select id="sortOrder" class="sort-select" onchange="filterAndSortGroups()">
                            <option value="recent" data-i18n="app.dashboard.sortRecent">📅 Most Recent</option>
                            <option value="oldest" data-i18n="app.dashboard.sortOldest">📅 Oldest First</option>
                            <option value="name-asc" data-i18n="app.dashboard.sortNameAsc">🔤 A → Z</option>
                            <option value="name-desc" data-i18n="app.dashboard.sortNameDesc">🔤 Z → A</option>
                        </select>
                    </div>
                </div>

                <!-- Loading State -->
                <div id="loadingGroups" class="loading-groups-state" style="display: none;">
                    <div class="loading-spinner"></div>
                    <h3 data-i18n="app.dashboard.loading">Loading your groups...</h3>
                    <p data-i18n="app.dashboard.loadingDesc">Please wait while we fetch your expense groups</p>
                </div>

                <!-- Groups Grid -->
                <div id="groupsGrid" class="groups-grid">
                    <!-- Groups will be loaded here -->
                </div>

                <!-- Empty State -->
                <div id="emptyState" class="empty-state" style="display: none;">
                    <div class="empty-icon">🚀</div>
                    <h3 data-i18n="app.dashboard.empty.title">Start your first adventure!</h3>
                    <p data-i18n="app.dashboard.empty.subtitle">Create your first group to manage shared expenses. <strong>No wallet needed</strong> - start with Simple Mode or use blockchain for automatic payments.</p>
                    <button class="btn btn-primary" onclick="document.getElementById('createFundBtn').click()">
                        <span class="btn-icon">✨</span>
                        <span data-i18n="app.dashboard.empty.button">Create My First Group</span>
                    </button>
                </div>

            </section>

            <!-- Fund Detail Section (Single Fund View) -->
            <section id="fundDetailSection" class="fund-detail-section">
                
                <!-- Fund Header with integrated back button and stats -->
                <div class="fund-detail-header">
                    <!-- Back Button -->
                    <button id="backToDashboard" class="back-button-integrated">
                        <span class="back-icon">←</span>
                        <span class="back-text" data-i18n="app.fundDetail.info.backToDashboard">Back to My Groups</span>
                    </button>

                    <!-- Header Content -->
                    <div class="fund-header-content">
                        <div class="fund-header-icon" id="fundHeaderIcon">🌴</div>
                        <div class="fund-header-main">
                            <div class="fund-title-row">
                                <h1 id="fundDetailName" class="fund-header-title">Cargando...</h1>
                                <button id="editGroupInfoBtn" class="btn-icon-small" onclick="showEditGroupModal()" style="display: none;" title="Edit group info">
                                    ✏️
                                </button>
                            </div>
                            <p id="fundDetailDescription" class="fund-header-description">-</p>
                            
                            <!-- Mascot and Colony Display Row -->
                            <div class="fund-systems-row">
                                <div id="mascotHeaderContainer" style="display: none;"></div>
                                <div id="colonyDisplayContainer" style="display: none;"></div>
                            </div>
                        </div>
                        <div class="fund-badges">
                            <span class="badge" id="fundTypeBadge" data-i18n="app.fundDetail.info.type">Tipo</span>
                            <span class="badge" id="groupStatusBadge" data-i18n="app.fundDetail.info.status">Estado</span>
                        </div>
                    </div>

                    <!-- Integrated Stats -->
                    <div class="fund-stats-integrated">
                        <div class="fund-stat-card">
                            <div class="stat-icon">💰</div>
                            <div class="stat-content">
                                <span class="stat-label" data-i18n="app.fundDetail.info.total">Total</span>
                                <span class="stat-value" id="fundBalanceMain">0 ETH</span>
                                <div class="stat-breakdown" id="fundBalanceBreakdown" style="display: none;"></div>
                            </div>
                        </div>
                        <div class="fund-stat-card">
                            <div class="stat-icon">👥</div>
                            <div class="stat-content">
                                <span class="stat-label" data-i18n="app.fundDetail.info.members">Members</span>
                                <span class="stat-value" id="fundMembers">0</span>
                            </div>
                        </div>
                        <div class="fund-stat-card">
                            <div class="stat-icon">💸</div>
                            <div class="stat-content">
                                <span class="stat-label" data-i18n="app.fundDetail.info.expenses">Expenses</span>
                                <span class="stat-value" id="fundProposals">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Invitation Banner (if pending) -->
                <div id="invitationBanner" class="invitation-banner" style="display: none;">
                    <div class="invitation-content">
                        <span class="invitation-icon">🎫</span>
                        <p data-i18n="app.fundDetail.banners.invitationText">You have a pending invitation for this fund</p>
                    </div>
                    <button id="acceptInvitationBtn" class="btn btn-primary" data-i18n="app.fundDetail.banners.accept">
                        Accept Invitation
                    </button>
                </div>

                <!-- Weekly Chest Banner Container -->
                <div id="weeklyChestBannerContainer"></div>

                <!-- Closed Fund Banner -->
                <div id="closedFundBanner" class="closed-fund-banner" style="display: none;">
                    <div class="closed-fund-content">
                        <span class="closed-fund-icon">🔒</span>
                        <div>
                            <h4 data-i18n="app.fundDetail.banners.closedTitle">Closed Group</h4>
                            <p data-i18n="app.fundDetail.banners.closedText">This group has been permanently closed. Balances were settled proportionally among all members.</p>
                        </div>
                    </div>
                </div>

                <!-- Fund Tabs -->
                <div class="fund-tabs">
                    <button class="fund-tab-btn active" data-tab="deposit">
                        <span class="tab-icon">💵</span>
                        <span data-i18n="app.fundDetail.tabs.deposit">Deposit</span>
                    </button>
                    <button class="fund-tab-btn" data-tab="invite">
                        <span class="tab-icon">🎫</span>
                        <span data-i18n="app.fundDetail.tabs.invite">Invite</span>
                    </button>
                    <button class="fund-tab-btn" data-tab="propose">
                        <span class="tab-icon">📝</span>
                        <span data-i18n="app.fundDetail.tabs.propose">Propose</span>
                    </button>
                    <button class="fund-tab-btn" data-tab="vote">
                        <span class="tab-icon">🗳️</span>
                        <span data-i18n="app.fundDetail.tabs.vote">Vote</span>
                    </button>
                    <button class="fund-tab-btn" data-tab="history">
                        <span class="tab-icon">📜</span>
                        <span data-i18n="app.fundDetail.tabs.history">History</span>
                    </button>
                    <button class="fund-tab-btn" data-tab="balances">
                        <span class="tab-icon">⚖️</span>
                        <span data-i18n="app.fundDetail.tabs.balances">Balances</span>
                    </button>
                    <button class="fund-tab-btn" data-tab="members">
                        <span class="tab-icon">👥</span>
                        <span data-i18n="app.fundDetail.tabs.members">Members</span>
                    </button>
                    <button class="fund-tab-btn" data-tab="mascot" style="display: none;">
                        <span class="tab-icon">🐜</span>
                        <span data-i18n="app.fundDetail.tabs.mascot">Mascot</span>
                    </button>
                    <button class="fund-tab-btn" data-tab="manage">
                        <span class="tab-icon">⚙️</span>
                        <span data-i18n="app.fundDetail.tabs.manage">Manage</span>
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="fund-tab-content">
                    
                    <!-- Deposit Tab -->
                    <div id="depositTab" class="tab-pane active">
                        <div class="tab-card">
                            <h3>💰 Contribute to the Pot</h3>
                            <p>Deposit money to the group. Useful for future expenses or to balance contributions.</p>
                            
                            <div class="form-group">
                                <label for="depositAmount">Amount to Deposit (ETH)</label>
                                <input type="number" id="depositAmount" placeholder="0.0" step="0.01" min="0.01">
                            </div>
                            
                            <div class="contribution-info">
                                <span>Your current contribution: <strong id="userContribution">0 ETH</strong></span>
                            </div>
                            
                            <button id="depositBtn" class="btn btn-primary btn-block">
                                Deposit to Pot
                            </button>
                        </div>
                    </div>

                    <!-- Invite Tab -->
                    <div id="inviteTab" class="tab-pane">
                        <div class="tab-card">
                            <h3>🎫 Invite Members</h3>
                            <p>Invite friends to join the group. They must accept the invitation.</p>
                            
                            <div class="invite-info-box">
                                <p><strong>ℹ️ Information:</strong></p>
                                <ul>
                                    <li>Only the group creator can invite</li>
                                    <li>Invitees will see the invitation in their dashboard</li>
                                    <li>They must accept before they can register expenses</li>
                                    <li>You cannot invite yourself</li>
                                </ul>
                            </div>
                            
                            <div class="form-group">
                                <label for="inviteAddress">Nickname or Address</label>
                                <input type="text" id="inviteAddress" placeholder="E.g: Bob or 0x123...">
                                <small>Enter the user's nickname or their Ethereum address</small>
                            </div>
                            
                            <button id="inviteBtn" class="btn btn-primary btn-block">
                                Send Invitation
                            </button>
                        </div>
                    </div>

                    <!-- Propose Tab -->
                    <div id="proposeTab" class="tab-pane">
                        <div class="tab-card">
                            <h3>📝 Propose Expense</h3>
                            <p>Propose using money from the common pot to pay an external provider. The group will vote whether to approve.</p>
                            
                            <div class="info-box">
                                <p><strong>💡 How it works:</strong></p>
                                <ul>
                                    <li>Propose paying an expense from the common pot (hotel, restaurant, etc.)</li>
                                    <li>Indicate who will be paid (external provider with their address)</li>
                                    <li>The group votes whether to approve or reject using money from the pot</li>
                                    <li>If approved, the money is sent directly from the pot to the provider</li>
                                </ul>
                            </div>
                            
                            <div class="form-group">
                                <label for="proposalRecipient">Who will be paid (Provider's address)</label>
                                <div class="input-with-button">
                                    <input type="text" id="proposalRecipient" placeholder="0x123... (hotel, restaurant, etc. address)">
                                    <button type="button" id="openQRScannerBtn" class="btn-qr-scan" title="Scan QR Code">
                                        📷
                                    </button>
                                </div>
                                <small>Ethereum address of the external agent who will receive payment</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="proposalAmount">Amount to Pay (ETH)</label>
                                <input type="number" id="proposalAmount" placeholder="0.0" step="0.01" min="0.01">
                                <small>Amount that will be paid from the common pot to the provider</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="proposalDescription">Expense Description</label>
                                <textarea id="proposalDescription" rows="3" placeholder="E.g: 3-night hotel in Cancun - Payment to Marriott, Group dinner at La Costa Restaurant..."></textarea>
                                <small>Explain the reason for the expense and who will be paid</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="involvedMembers">Who is involved in this expense?</label>
                                <div class="info-box warning" style="margin-bottom: 1rem; background: rgba(251, 191, 36, 0.1); border-color: rgba(251, 191, 36, 0.3);">
                                    <p><strong>⚠️ IMPORTANTE:</strong></p>
                                    <ul style="margin: 0.5rem 0 0 1.2rem; font-size: 0.9rem;">
                                        <li><strong>Only selected members can vote!</strong></li>
                                        <li>Make sure to check YOUR OWN checkbox if you want to vote</li>
                                        <li>If you uncheck yourself, you won't be able to vote on your own proposal</li>
                                    </ul>
                                </div>
                                <div class="info-box" style="margin-bottom: 1rem; background: rgba(99, 102, 241, 0.1); border-color: rgba(99, 102, 241, 0.3);">
                                    <p><strong>💡 Flexible Bill Splitting:</strong></p>
                                    <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">
                                        Use the <strong>+</strong> and <strong>−</strong> buttons to add extra portions when a member covers for people outside the group. 
                                        For example: if your sister brings 2 friends, add 3 portions (her + 2 friends) and the expense will be split counting her 3 times.
                                    </p>
                                </div>
                                <div class="members-selection-actions">
                                    <button type="button" id="selectAllMembersBtn" class="btn-select-action">
                                        ✓ Select All
                                    </button>
                                    <button type="button" id="deselectAllMembersBtn" class="btn-select-action">
                                        ✗ Deselect All
                                    </button>
                                </div>
                                <div id="involvedMembersList" class="members-checkbox-list">
                                    <!-- Member checkboxes will be loaded here -->
                                </div>
                                <small>Select the members who will share this expense. Use the +/− buttons to adjust how many portions of the expense correspond to each member.</small>
                            </div>
                            
                            <button id="createProposalBtn" class="btn btn-primary btn-block">
                                📝 Propose Settlement
                            </button>
                        </div>
                    </div>

                    <!-- Vote Tab -->
                    <div id="voteTab" class="tab-pane">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <div>
                                <h3>🗳️ Vote on Proposals</h3>
                                <p class="tab-description">Settlement proposals. Vote whether you approve or reject each payment.</p>
                            </div>
                            <button onclick="refreshCurrentView()" class="btn btn-secondary" style="height: fit-content;" title="Refresh proposals from blockchain">
                                🔄 Refresh
                            </button>
                        </div>
                        <div id="proposalsList">
                            <!-- Proposals will be loaded here -->
                        </div>
                        <div id="noProposals" class="empty-state" style="display: none;">
                            <div class="empty-icon">📋</div>
                            <h4>No active proposals</h4>
                            <p>Create the first proposal for this fund</p>
                        </div>
                    </div>

                    <!-- History Tab -->
                    <div id="historyTab" class="tab-pane">
                        <!-- Simple Mode: Add Expense Action Card -->
                        <div id="simpleAddExpenseCard" class="action-card" style="display: none;">
                            <div class="action-card-content">
                                <div class="action-card-icon">💸</div>
                                <div class="action-card-text">
                                    <h4 data-i18n="app.fundDetail.history.addExpenseTitle">Register an Expense</h4>
                                    <p data-i18n="app.fundDetail.history.addExpenseSubtitle">Track shared expenses with your group. Split costs fairly and keep everyone in sync.</p>
                                </div>
                                <button id="addExpenseCardBtn" class="btn btn-large btn-add-expense" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white !important; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.35);" data-i18n-title="app.fundDetail.history.addExpenseTitle">
                                    <span class="btn-icon" style="background: rgba(255,255,255,0.2); padding: 0.4rem; border-radius: 6px; font-size: 1.2rem;">💵</span>
                                    <span class="btn-text" style="display: flex; flex-direction: column; align-items: flex-start; gap: 0.1rem;">
                                        <strong style="color: white !important; font-weight: 600; font-size: 0.9rem;" data-i18n="app.fundDetail.history.addExpenseButton">Add Expense</strong>
                                        <small style="color: rgba(255,255,255,0.85) !important; font-size: 0.7rem;" data-i18n="app.fundDetail.history.addExpenseButtonSmall">Click to add</small>
                                    </span>
                                </button>
                            </div>
                        </div>

                        <!-- Quick Actions for New Features -->
                        <div id="simpleQuickActions" class="quick-actions-compact" style="display: none; margin-bottom: 1rem;">
                            <button class="quick-action-btn-compact pro-feature-btn" onclick="showRecurringExpenseModal()" data-i18n-title="app.fundDetail.history.quickActionsRecurringTitle">
                                <span class="quick-icon">🔄</span>
                                <span class="quick-label" data-i18n="app.fundDetail.history.quickActionsRecurring">Recurring</span>
                                <span class="pro-badge-inline">💎</span>
                            </button>
                            
                            <button class="quick-action-btn-compact pro-feature-btn" onclick="showBudgetModal()" data-i18n-title="app.fundDetail.history.quickActionsBudgetTitle">
                                <span class="quick-icon">💰</span>
                                <span class="quick-label" data-i18n="app.fundDetail.history.quickActionsBudget">Budget</span>
                                <span class="pro-badge-inline">💎</span>
                            </button>
                            
                            <button class="quick-action-btn-compact pro-feature-btn" onclick="showAnalyticsModal()" data-i18n-title="app.fundDetail.history.quickActionsAnalyticsTitle">
                                <span class="quick-icon">📊</span>
                                <span class="quick-label" data-i18n="app.fundDetail.history.quickActionsAnalytics">Analytics</span>
                                <span class="pro-badge-inline">💎</span>
                            </button>
                            
                            <button class="quick-action-btn-compact" onclick="showOpenAIConfigModal()" data-i18n-title="app.fundDetail.history.quickActionsAISetupTitle">
                                <span class="quick-icon">🔑</span>
                                <span class="quick-label" data-i18n="app.fundDetail.history.quickActionsAISetup">AI Setup</span>
                            </button>
                        </div>

                        <!-- Budget Status Bar (if budget is set) -->
                        <div id="budgetStatusBar" style="display: none; margin-bottom: 1.5rem;">
                            <div class="collapsible-header" onclick="toggleCollapsible('budgetContent')" style="background: rgba(255,255,255,0.05); padding: 1rem 1.5rem; border-radius: 8px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: background 0.2s ease;">
                                <div style="display: flex; align-items: center; gap: 0.75rem;">
                                    <span style="font-size: 1.2rem;">💰</span>
                                    <strong style="font-size: 1rem;" data-i18n="app.fundDetail.history.budgetTracker">Budget Tracker</strong>
                                </div>
                                <span id="budgetContentToggle" style="font-size: 1.2rem; transition: transform 0.3s ease;">▼</span>
                            </div>
                            <div id="budgetContent" class="collapsible-content" style="display: none; margin-top: 0.5rem;">
                                <!-- Populated dynamically -->
                            </div>
                        </div>

                        <!-- Active Recurring Expenses -->
                        <div id="recurringExpensesSection" style="display: none; margin-bottom: 1.5rem;">
                            <div class="collapsible-header" onclick="toggleCollapsible('recurringContent')" style="background: rgba(255,255,255,0.05); padding: 1rem 1.5rem; border-radius: 8px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: background 0.2s ease;">
                                <div style="display: flex; align-items: center; gap: 0.75rem;">
                                    <span style="font-size: 1.2rem;">🔄</span>
                                    <strong style="font-size: 1rem;" data-i18n="app.fundDetail.history.recurringExpensesTitle">Active Recurring Expenses</strong>
                                    <span id="recurringCount" class="badge-count" style="background: #667eea; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.85rem;">0</span>
                                </div>
                                <span id="recurringContentToggle" style="font-size: 1.2rem; transition: transform 0.3s ease;">▼</span>
                            </div>
                            <div id="recurringContent" class="collapsible-content" style="display: none; margin-top: 0.5rem;">
                                <div style="text-align: right; margin-bottom: 0.75rem;">
                                    <button class="btn btn-secondary btn-small" onclick="showManageRecurringModal()" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
                                        <span data-i18n="app.fundDetail.history.recurringViewAll">📋 View All</span>
                                    </button>
                                </div>
                                <div id="recurringExpensesList" class="recurring-list">
                                    <!-- Populated dynamically -->
                                </div>
                            </div>
                        </div>

                        <h3 data-i18n="app.fundDetail.history.title">📜 Proposal History</h3>
                        <p class="tab-description" data-i18n="app.fundDetail.history.description">All proposals: executed, cancelled and expired</p>
                        
                        <!-- Expense Search Filter - Collapsible -->
                        <div id="expenseSearchSection" style="display: none; margin-bottom: 1rem;">
                            <div class="collapsible-header" onclick="toggleCollapsible('searchContent')" style="background: rgba(255,255,255,0.05); padding: 1rem 1.5rem; border-radius: 8px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: background 0.2s ease;">
                                <div style="display: flex; align-items: center; gap: 0.75rem;">
                                    <span style="font-size: 1.2rem;">🔍</span>
                                    <strong style="font-size: 1rem;" data-i18n="app.fundDetail.history.searchTitle">Search & Filter</strong>
                                </div>
                                <span id="searchContentToggle" style="font-size: 1.2rem; transition: transform 0.3s ease;">▼</span>
                            </div>
                            <div id="searchContent" class="collapsible-content" style="display: none; margin-top: 0.5rem;">
                                <div class="expense-search-section">
                                    <div class="search-filters">
                                        <div class="search-input-wrapper">
                                            <input type="text" 
                                                   id="expenseSearchInput" 
                                                   class="search-input" 
                                                   data-i18n-placeholder="app.fundDetail.history.searchPlaceholder"
                                                   placeholder="🔍 Search by name..." 
                                                   onkeyup="filterExpenses()">
                                        </div>
                                        <div class="date-filters-row">
                                            <div class="date-filter-group">
                                                <label class="filter-label" data-i18n="app.fundDetail.history.searchFrom">From:</label>
                                                <input type="date" 
                                                       id="expenseFilterStart" 
                                                       class="date-filter-input" 
                                                       onchange="filterExpenses()">
                                            </div>
                                            <div class="date-filter-group">
                                                <label class="filter-label" data-i18n="app.fundDetail.history.searchTo">To:</label>
                                                <input type="date" 
                                                       id="expenseFilterEnd" 
                                                       class="date-filter-input" 
                                                       onchange="filterExpenses()">
                                            </div>
                                            <button class="btn-clear-filters" onclick="clearExpenseFilters()" data-i18n-title="app.fundDetail.history.searchClear">
                                                ✕
                                            </button>
                                        </div>
                                        <div class="filter-checkbox-row" style="margin-top: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                                            <label class="filter-checkbox-label" style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                                <input type="checkbox" id="expenseFilterMyExpenses" onchange="filterExpenses()" style="cursor: pointer;">
                                                <span data-i18n="app.fundDetail.history.searchMyExpenses">🙋 Only my expenses (where I'm involved)</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="historyList">
                            <!-- History will be loaded here -->
                        </div>
                        <div id="noHistory" class="empty-state" style="display: none;">
                            <div class="empty-icon">📋</div>
                            <h4 data-i18n="app.fundDetail.history.empty">No history yet</h4>
                            <p data-i18n="app.fundDetail.history.emptySubtitle">Proposal history will appear here</p>
                        </div>
                    </div>

                    <!-- Balances Tab -->
                    <div id="balancesTab" class="tab-pane">
                        <div class="balances-header-simple">
                            <h3 data-i18n="app.fundDetail.balances.title">⚖️ Group Balances</h3>
                            <p class="tab-description" data-i18n="app.fundDetail.balances.description">See who owes money and who is owed based on shared expenses</p>
                        </div>

                        <!-- Date Filter for Timeline -->
                        <div id="timelineFilterSection" class="timeline-filter-section" style="display: none;">
                            <div class="filter-header">
                                <h4 data-i18n="app.fundDetail.balances.timelineTitle">📅 Expense Timeline</h4>
                                <button class="toggle-timeline-btn" onclick="toggleTimeline()">
                                    <span id="timelineToggleIcon">▼</span> <span id="timelineToggleText" data-i18n="app.fundDetail.balances.timelineShow">Show Timeline</span>
                                </button>
                            </div>
                            <div id="timelineContent" class="timeline-content" style="display: none;">
                                <div class="date-range-selector">
                                    <div class="date-input-group">
                                        <label for="startDate" data-i18n="app.fundDetail.balances.timelineFrom">From:</label>
                                        <input type="date" id="startDate" class="date-input" onchange="filterTimelineByDate()">
                                    </div>
                                    <div class="date-input-group">
                                        <label for="endDate" data-i18n="app.fundDetail.balances.timelineTo">To:</label>
                                        <input type="date" id="endDate" class="date-input" onchange="filterTimelineByDate()">
                                    </div>
                                    <button class="btn-reset-dates" onclick="resetDateFilter()">
                                        <span data-i18n="app.fundDetail.balances.timelineReset">🔄 Reset</span>
                                    </button>
                                </div>
                                <div id="expenseTimeline" class="expense-timeline">
                                    <!-- Timeline items will be rendered here -->
                                </div>
                            </div>
                        </div>

                        <!-- Balance Dashboard for Simple Mode -->
                        <div id="simpleModeBalanceDashboard" class="balance-dashboard-simple" style="display: none;">
                            <div class="dashboard-stats">
                                <div class="stat-card stat-expenses">
                                    <div class="stat-icon">💸</div>
                                    <div class="stat-content">
                                        <span class="stat-label" data-i18n="app.fundDetail.balances.totalExpensesSimple">Total Expenses</span>
                                        <span class="stat-value" id="simpleModeTotalExpenses">$0</span>
                                    </div>
                                </div>
                                <div class="stat-card stat-per-person">
                                    <div class="stat-icon">👤</div>
                                    <div class="stat-content">
                                        <span class="stat-label" data-i18n="app.fundDetail.balances.perPerson">Per Person</span>
                                        <span class="stat-value" id="simpleModePerPerson">$0</span>
                                    </div>
                                </div>
                                <div class="stat-card stat-members">
                                    <div class="stat-icon">👥</div>
                                    <div class="stat-content">
                                        <span class="stat-label" data-i18n="app.fundDetail.balances.activeMembers">Active Members</span>
                                        <span class="stat-value" id="simpleModeActiveMembers">0</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Visual Balance Chart -->
                            <div class="balance-chart-container">
                                <h4 class="chart-title" data-i18n="app.fundDetail.balances.balanceOverview">💰 Balance Overview</h4>
                                <p class="chart-description" style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 1rem;">
                                    Este gráfico muestra quién debe y quién le deben dinero. Las barras verdes indican que a esa persona le deben (+), las rojas que esa persona debe (-). Más grande la barra = mayor el monto.
                                </p>
                                <div id="balanceChart" class="balance-chart">
                                    <!-- Chart will be rendered here -->
                                </div>
                            </div>
                        </div>

                        <!-- Balance List -->
                        <div class="balances-list-container">
                            <div id="balancesList" class="balances-list-simple">
                                <!-- Balances will be loaded here -->
                            </div>
                            
                            <div id="noBalances" class="empty-state" style="display: none;">
                                <div class="empty-icon">⚖️</div>
                                <h4 data-i18n="app.fundDetail.balances.empty">No members yet</h4>
                                <p data-i18n="app.fundDetail.balances.emptySubtitle">Balances will appear when members start contributing to expenses</p>
                            </div>
                        </div>

                        <!-- Smart Settlements Button -->
                        <div id="smartSettlementsSection" class="smart-settlements-section" style="display: none;">
                            <button class="btn-smart-settle" onclick="openSmartSettlements()">
                                <span class="btn-icon">🎯</span>
                                <div class="btn-content">
                                    <span class="btn-title" data-i18n="app.fundDetail.balances.smartSettlements">Smart Settlements</span>
                                    <span class="btn-subtitle" data-i18n="app.fundDetail.balances.smartSettlementsSubtitle">Simplify payments with one click</span>
                                </div>
                            </button>
                        </div>

                        <!-- How it works info -->
                        <div class="info-box-simple">
                            <h4 data-i18n="app.fundDetail.balances.howItWorks">💡 How balances work:</h4>
                            <ul class="info-list">
                                <li><strong>Green (+):</strong> <span data-i18n="app.fundDetail.balances.howItWorksGreen">Others owe you money</span></li>
                                <li><strong>Red (-):</strong> <span data-i18n="app.fundDetail.balances.howItWorksRed">You owe money to others</span></li>
                                <li><strong>Balanced transactions:</strong> <span data-i18n="app.fundDetail.balances.howItWorksBalanced">Simplified to minimize payments</span></li>
                            </ul>
                        </div>
                    </div>

                    <!-- Members Tab -->
                    <div id="membersTab" class="tab-pane">
                        <h3 data-i18n="app.fundDetail.members.title">👥 Fund Members <span id="memberCounter" style="color: #888; font-size: 0.9rem; font-weight: normal;"></span></h3>
                        
                        <!-- Removal Requests Section (Only for creator) -->
                        <div id="removalRequestsSection" style="display: none; margin-bottom: 2rem;">
                            <h4 style="color: var(--warning); margin-bottom: 1rem;" data-i18n="app.fundDetail.members.removalRequestsTitle">⚠️ Pending Removal Requests</h4>
                            <div id="removalRequestsList">
                                <!-- Removal requests will be loaded here -->
                            </div>
                        </div>
                        
                        <div id="membersList">
                            <!-- Members will be loaded here -->
                        </div>
                        <div id="noMembers" class="empty-state" style="display: none;">
                            <div class="empty-icon">👤</div>
                            <h4 data-i18n="app.fundDetail.members.empty">No members yet</h4>
                        </div>
                    </div>

                    <!-- Mascot Tab -->
                    <div id="mascotTab" class="tab-pane">
                        <!-- Content will be dynamically loaded by mascot-system.js -->
                        <div style="text-align: center; padding: 3rem; color: var(--text-tertiary);">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">🐜</div>
                            <p data-i18n="app.fundDetail.mascot.loading">Loading group mascot...</p>
                        </div>
                    </div>

                    <!-- Manage Tab -->
                    <div id="manageTab" class="tab-pane">
                        <div class="tab-card">
                            <h3 data-i18n="app.fundDetail.manage.title">⚙️ Fund Management</h3>
                            <p data-i18n="app.fundDetail.manage.subtitleGroup">Advanced options to manage the fund.</p>
                            
                            <div class="manage-section">
                                <!-- Kick Member Section -->
                                <div class="member-management-section">
                                    <h4 data-i18n="app.fundDetail.manage.memberManagement">👥 Member Management</h4>
                                    <p><strong data-i18n="app.fundDetail.manage.kickMember">Remove Member</strong></p>
                                    <p class="help-text" data-i18n="app.fundDetail.manage.kickDescriptionSimple">
                                        Remove a member from the group by returning their proportional share of the current balance.
                                    </p>
                                    
                                    <div class="info-box">
                                        <p><strong data-i18n="app.fundDetail.manage.howItWorks">💡 How it works:</strong></p>
                                        <ul>
                                            <li data-i18n="app.fundDetail.manage.kickPoint1">The member is permanently removed from the group</li>
                                            <li data-i18n="app.fundDetail.manage.kickPoint2">Receives: (Their contribution / Total contributions) × Current balance</li>
                                            <li data-i18n="app.fundDetail.manage.kickPoint3">Cannot participate in future votes</li>
                                            <li data-i18n="app.fundDetail.manage.kickPoint4">Their previous votes remain recorded</li>
                                        </ul>
                                    </div>
                                    
                                    <div id="kickMembersList" class="kick-members-list">
                                        <!-- Member cards will be loaded here -->
                                    </div>
                                    
                                    <div id="noMembersToKick" class="empty-state" style="display: none;">
                                        <div class="empty-icon">👥</div>
                                        <h4 data-i18n="app.fundDetail.manage.noMembersToKick">No members to remove</h4>
                                        <p data-i18n="app.fundDetail.manage.noMembersSubtitle">There is only one member in the group or you are not the creator</p>
                                    </div>
                                </div>
                                
                                <div class="danger-zone">
                                    <h4 data-i18n="app.fundDetail.manage.dangerZone">🚨 Danger Zone</h4>
                                    <p><strong data-i18n="app.fundDetail.manage.closeAndDistribute">Close and Distribute Fund</strong></p>
                                    <p class="help-text" data-i18n="app.fundDetail.manage.closeDescription">
                                        This action will permanently close the group and settle all remaining balances 
                                        proportionally among contributors according to their contribution.
                                    </p>
                                    
                                    <div class="info-box warning-box">
                                        <p><strong data-i18n="app.fundDetail.manage.warning">⚠️ Warning:</strong></p>
                                        <ul>
                                            <li data-i18n="app.fundDetail.manage.warningPoint1">This action is <strong>irreversible</strong></li>
                                            <li data-i18n="app.fundDetail.manage.warningPoint2">Only the fund creator can execute it</li>
                                            <li data-i18n="app.fundDetail.manage.warningPoint3">Each contributor will receive: (their contribution / total) × current balance</li>
                                            <li data-i18n="app.fundDetail.manage.warningPoint4">The fund will be permanently closed</li>
                                            <li data-i18n="app.fundDetail.manage.warningPoint5">No more deposits or proposals can be made</li>
                                        </ul>
                                    </div>
                                    
                                    <div id="closeFundPreview" class="distribution-preview" style="display: none;">
                                        <h5 data-i18n="app.fundDetail.manage.distributionPreview">📊 Distribution Preview</h5>
                                        <div id="distributionList"></div>
                                    </div>
                                    
                                    <div class="button-group">
                                        <button id="previewCloseFundBtn" class="btn btn-secondary" data-i18n="app.fundDetail.manage.previewButton">
                                            📊 Distribution Preview
                                        </button>
                                        <button id="closeFundBtn" class="btn btn-danger" data-i18n="app.fundDetail.manage.closeButton">
                                            🔒 Close and Distribute Fund
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </section>

            <!-- Floating Add Expense Button (Simple Mode only) -->
            <div id="addExpenseBtn" class="fab-container" style="display: none;">
                <button class="fab-main" onclick="toggleFabMenu()" title="Quick Actions">
                    <span class="fab-icon">➕</span>
                </button>
                <div class="fab-menu" id="fabMenu" style="display: none;">
                    <button class="fab-option" onclick="showAddExpenseModal()" title="Add Expense">
                        <span class="fab-option-icon">💵</span>
                        <span class="fab-option-text">Add Expense</span>
                    </button>
                    <button class="fab-option" onclick="showAddRecurringExpenseModal()" title="Recurring Expense">
                        <span class="fab-option-icon">🔄</span>
                        <span class="fab-option-text">Recurring Expense</span>
                    </button>
                </div>
            </div>

            <!-- Add Expense Modal (Simple Mode) -->
            <div id="addExpenseModal" class="modal" style="display: none;">
                <div class="modal-content modal-medium">
                    <div class="modal-header">
                        <h2 data-i18n="app.modals.addExpense.titleIcon">➕ Add Expense</h2>
                        <button class="modal-close" onclick="closeAddExpenseModal()">&times;</button>
                    </div>
                    
                    <form id="addExpenseForm" class="expense-form-clean">
                        <div class="form-header-clean">
                            <h3 data-i18n="app.modals.addExpense.title">Add Expense</h3>
                            <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem; flex-wrap: wrap;">
                                <button type="button" class="btn-scan-receipt" onclick="triggerReceiptScan()">
                                    <span data-i18n="app.modals.addExpense.scanReceipt">📸 Scan Receipt</span>
                                </button>
                                <button type="button" class="btn-challenge-mode" onclick="showChallengeModeSelection()">
                                    <span data-i18n="app.modals.addExpense.challengeMode">🎮 Challenge Mode</span>
                                </button>
                                <input 
                                    type="file" 
                                    id="receiptImageInput" 
                                    accept="image/*" 
                                    capture="environment"
                                    style="display: none;"
                                    onchange="handleReceiptImage(event)"
                                >
                            </div>
                        </div>

                        <div id="scanningIndicator" style="display: none; background: rgba(102, 126, 234, 0.1); border-left: 3px solid #667eea; padding: 1rem; border-radius: 8px; margin: 1rem 1.5rem;">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <div class="spinner-small"></div>
                                <div>
                                    <strong style="color: #667eea;" data-i18n="app.modals.addExpense.scanningReceipt">Scanning receipt...</strong>
                                    <p style="margin: 0.25rem 0 0 0; font-size: 0.85rem; color: rgba(255,255,255,0.7);" data-i18n="app.modals.addExpense.extractingInfo">
                                        Extracting amount, description, and date from image
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-field">
                                <label for="expenseDescription" class="form-label" data-i18n="app.modals.addExpense.descriptionLabel">Description *</label>
                                <input 
                                    type="text" 
                                    id="expenseDescription"
                                    name="description"
                                    class="form-input"
                                    data-i18n-placeholder="app.modals.addExpense.descriptionPlaceholder"
                                    placeholder="What did you pay for?"
                                    required
                                    autocomplete="off"
                                >
                            </div>

                            <div class="form-field">
                                <label for="expenseAmount" class="form-label" data-i18n="app.modals.addExpense.amountLabel">Amount *</label>
                                <div class="form-hint" style="margin-bottom: 0.5rem; font-size: 0.85rem; color: #9ca3af;" data-i18n="app.modals.addExpense.amountHint">
                                    Enter a <strong>positive</strong> number for expenses, or a <strong>negative</strong> number for payments received/loans.
                                </div>
                                <div class="amount-input-wrapper">
                                    <span class="currency-symbol" id="currencySymbol">$</span>
                                    <input 
                                        type="number" 
                                        id="expenseAmount"
                                        name="amount"
                                        class="form-input amount-input"
                                        data-i18n-placeholder="app.modals.addExpense.amountPlaceholder"
                                        placeholder="0.00"
                                        step="any"
                                        required
                                    >
                                </div>
                                <div class="form-examples" style="margin-top: 0.5rem; font-size: 0.75rem; color: #6b7280;" data-i18n="app.modals.addExpense.amountExample">
                                    Examples: 50 (expense), -50 (payment received)
                                </div>
                            </div>

                            <div class="form-field">
                                <label for="expenseCurrency" class="form-label" data-i18n="app.modals.addExpense.currencyLabel">Currency</label>
                                <select id="expenseCurrency" name="currency" class="form-input form-select" onchange="updateCurrencySymbol()">
                                    <option value="USD" selected data-i18n="app.modals.addExpense.currencyOptions.usd">🇺🇸 USD - US Dollar</option>
                                    <option value="EUR" data-i18n="app.modals.addExpense.currencyOptions.eur">🇪🇺 EUR - Euro</option>
                                    <option value="GBP" data-i18n="app.modals.addExpense.currencyOptions.gbp">🇬🇧 GBP - British Pound</option>
                                    <option value="MXN" data-i18n="app.modals.addExpense.currencyOptions.mxn">🇲🇽 MXN - Mexican Peso</option>
                                    <option value="COP" data-i18n="app.modals.addExpense.currencyOptions.cop">🇨🇴 COP - Colombian Peso</option>
                                    <option value="BRL" data-i18n="app.modals.addExpense.currencyOptions.brl">🇧🇷 BRL - Brazilian Real</option>
                                    <option value="CAD" data-i18n="app.modals.addExpense.currencyOptions.cad">🇨🇦 CAD - Canadian Dollar</option>
                                    <option value="AUD" data-i18n="app.modals.addExpense.currencyOptions.aud">🇦🇺 AUD - Australian Dollar</option>
                                    <option value="JPY" data-i18n="app.modals.addExpense.currencyOptions.jpy">🇯🇵 JPY - Japanese Yen</option>
                                    <option value="CNY" data-i18n="app.modals.addExpense.currencyOptions.cny">🇨🇳 CNY - Chinese Yuan</option>
                                    <option value="INR" data-i18n="app.modals.addExpense.currencyOptions.inr">🇮🇳 INR - Indian Rupee</option>
                                    <option value="CHF" data-i18n="app.modals.addExpense.currencyOptions.chf">🇨🇭 CHF - Swiss Franc</option>
                                </select>
                            </div>

                            <div class="form-field">
                                <label class="form-label" data-i18n="app.modals.addExpense.paidByLabel">Paid by *</label>
                                <div id="expensePaidBy" class="split-members-list">
                                    <!-- Will be populated dynamically with checkboxes -->
                                </div>
                                <small class="field-hint" data-i18n="app.modals.addExpense.paidByHint">Select who paid (can be multiple people)</small>
                            </div>

                            <div class="form-field">
                                <label for="expenseDate" class="form-label" data-i18n="app.modals.addExpense.dateLabel">Date</label>
                                <input 
                                    type="date" 
                                    id="expenseDate"
                                    name="date"
                                    class="form-input"
                                >
                            </div>

                            <div class="form-field">
                                <label for="expenseCategory" class="form-label" data-i18n="app.modals.addExpense.categoryLabel">Category</label>
                                <select id="expenseCategory" name="category" class="form-input form-select">
                                    <option value="food" data-i18n="app.modals.addExpense.categoryOptions.food">🍕 Food & Dining</option>
                                    <option value="transport" data-i18n="app.modals.addExpense.categoryOptions.transport">🚗 Transportation</option>
                                    <option value="housing" data-i18n="app.modals.addExpense.categoryOptions.housing">🏠 Housing & Rent</option>
                                    <option value="utilities" data-i18n="app.modals.addExpense.categoryOptions.utilities">💡 Utilities</option>
                                    <option value="entertainment" data-i18n="app.modals.addExpense.categoryOptions.entertainment">🎬 Entertainment</option>
                                    <option value="shopping" data-i18n="app.modals.addExpense.categoryOptions.shopping">🛍️ Shopping</option>
                                    <option value="health" data-i18n="app.modals.addExpense.categoryOptions.health">⚕️ Health & Medical</option>
                                    <option value="travel" data-i18n="app.modals.addExpense.categoryOptions.travel">✈️ Travel</option>
                                    <option value="subscription" data-i18n="app.modals.addExpense.categoryOptions.subscription">📺 Subscriptions</option>
                                    <option value="other" selected data-i18n="app.modals.addExpense.categoryOptions.other">🎯 Other</option>
                                </select>
                                <small class="field-hint">Helps with analytics and expense tracking</small>
                            </div>

                            <div class="form-field">
                                <label class="form-label" data-i18n="app.modals.addExpense.splitBetweenLabel">Split between *</label>
                                <div class="info-box" style="margin-bottom: 0.75rem; background: rgba(99, 102, 241, 0.1); border-color: rgba(99, 102, 241, 0.3); padding: 0.75rem;">
                                    <p style="margin: 0; font-size: 0.85rem; display: flex; align-items: start; gap: 0.5rem;" data-i18n="app.modals.addExpense.splitBetweenInfo">
                                        <span style="font-size: 1rem;">💡</span>
                                        <span>
                                            <strong>Flexible splitting:</strong> Use the <strong>+</strong> and <strong>−</strong> buttons to add portions when a member covers for external guests. 
                                            Example: If someone brings 2 guests, add 3 portions (them + 2 guests).
                                        </span>
                                    </p>
                                </div>
                                <div id="expenseSplitBetween" class="split-members-list">
                                    <!-- Will be populated dynamically -->
                                </div>
                                <small class="field-hint" data-i18n="app.modals.addExpense.splitBetweenHint">Select who should share this expense</small>
                            </div>

                            <div class="form-field">
                                <label for="expenseNotes" class="form-label"><span data-i18n="app.modals.addExpense.notesLabel">Notes</span> <span class="optional-badge" data-i18n="app.modals.addExpense.notesOptional">Optional</span></label>
                                <textarea 
                                    id="expenseNotes"
                                    name="notes"
                                    class="form-input form-textarea"
                                    rows="2"
                                    data-i18n-placeholder="app.modals.addExpense.notesPlaceholder"
                                    placeholder="Add any additional details..."
                                ></textarea>
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeAddExpenseModal()">
                                <span data-i18n="app.modals.addExpense.cancelButton">Cancel</span>
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <span data-i18n="app.modals.addExpense.saveButton">Save Expense</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Record Payment Modal -->
            <div id="recordPaymentModal" class="modal" style="display: none;">
                <div class="modal-content record-payment-modal-v3">
                    <button class="modal-close-btn" onclick="closeRecordPaymentModal()">&times;</button>
                    
                    <!-- Visual Header with Animation -->
                    <div class="record-payment-hero">
                        <div class="payment-visual">
                            <div class="payment-from-avatar">👤</div>
                            <div class="payment-arrow">
                                <div class="arrow-line"></div>
                                <div class="arrow-money">💸</div>
                            </div>
                            <div class="payment-to-avatar" id="paymentToAvatar">👤</div>
                        </div>
                        <h2 data-i18n="app.modals.recordPayment.title">Record Payment</h2>
                    </div>
                    
                    <form id="recordPaymentForm" class="record-payment-form-v3">
                        <!-- Recipient Card -->
                        <div class="payment-recipient-card">
                            <div class="recipient-label" data-i18n="app.modals.recordPayment.payingTo">Paying to</div>
                            <div class="recipient-name" id="paymentTo">-</div>
                        </div>

                        <!-- Amount Input - Hero Style -->
                        <div class="payment-amount-section">
                            <label class="amount-label" data-i18n="app.modals.recordPayment.amountLabel">Amount</label>
                            <div class="amount-input-wrapper">
                                <span class="currency-symbol" id="paymentCurrencyBadge">$</span>
                                <input 
                                    type="number" 
                                    id="paymentAmount" 
                                    name="amount"
                                    class="amount-input" 
                                    step="0.01" 
                                    min="0.01"
                                    required
                                    data-i18n-placeholder="app.modals.recordPayment.amountPlaceholder"
                                    placeholder="0.00"
                                >
                            </div>
                        </div>

                        <!-- Additional Fields in Cards -->
                        <div class="payment-details-grid">
                            <div class="detail-field">
                                <label for="paymentDate">
                                    <span class="field-icon">📅</span>
                                    <span data-i18n="app.modals.recordPayment.dateLabel">Date</span>
                                </label>
                                <input 
                                    type="date" 
                                    id="paymentDate" 
                                    name="date"
                                    class="detail-input"
                                    required
                                >
                            </div>

                            <div class="detail-field detail-field-full">
                                <label for="paymentNotes">
                                    <span class="field-icon">📝</span>
                                    <span data-i18n="app.modals.recordPayment.notesLabel">Notes</span>
                                    <span class="optional-tag" data-i18n="app.modals.recordPayment.optional">Optional</span>
                                </label>
                                <input 
                                    type="text" 
                                    id="paymentNotes" 
                                    name="notes"
                                    class="detail-input"
                                    data-i18n-placeholder="app.modals.recordPayment.notesPlaceholder"
                                    placeholder="Venmo, cash, bank transfer..."
                                >
                            </div>
                        </div>

                        <input type="hidden" id="paymentToId" name="toUserId">

                        <!-- Action Buttons -->
                        <div class="payment-actions">
                            <button type="button" class="btn-payment-cancel" onclick="closeRecordPaymentModal()">
                                <span data-i18n="app.modals.recordPayment.cancelButton">Cancel</span>
                            </button>
                            <button type="submit" class="btn-payment-submit">
                                <span class="btn-check">✓</span>
                                <span data-i18n="app.modals.recordPayment.recordButton">Record Payment</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Create Fund Modal -->
            <div id="createFundModal" class="modal" style="display: none;">
                <div class="modal-content create-group-modal-v2">
                    <button class="modal-close-btn" onclick="closeCreateFundModal()">&times;</button>
                    
                    <div class="create-group-header">
                        <div class="create-group-icon">🐜</div>
                        <h2 data-i18n="app.createFund.title">Create New Group</h2>
                        <p data-i18n="app.createFund.step1.subtitle">Give it a name everyone will easily recognize</p>
                    </div>
                    
                    <form id="createFundForm" class="create-group-form-v2" onsubmit="createFund(event)">
                        <!-- Group Name -->
                        <div class="form-field">
                            <label for="fundName">
                                <span data-i18n="app.createFund.fields.name">Group Name</span>
                                <span class="required">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="fundName" 
                                data-i18n-placeholder="app.createFund.fields.namePlaceholder"
                                placeholder="E.g: Cancun Trip, Roommates 2025" 
                                required 
                                autocomplete="off"
                            />
                        </div>

                        <!-- Icon Selection -->
                        <div class="form-field">
                            <label data-i18n="app.createFund.step1.groupIcon">Group Icon</label>
                            <div class="icon-grid">
                                <input type="radio" name="groupIcon" value="🐕" id="icon-dog" checked />
                                <label for="icon-dog">🐕</label>
                                
                                <input type="radio" name="groupIcon" value="✈️" id="icon-plane" />
                                <label for="icon-plane">✈️</label>
                                
                                <input type="radio" name="groupIcon" value="🏠" id="icon-home" />
                                <label for="icon-home">🏠</label>
                                
                                <input type="radio" name="groupIcon" value="🎉" id="icon-party" />
                                <label for="icon-party">🎉</label>
                                
                                <input type="radio" name="groupIcon" value="💼" id="icon-briefcase" />
                                <label for="icon-briefcase">💼</label>
                                
                                <input type="radio" name="groupIcon" value="🍕" id="icon-pizza" />
                                <label for="icon-pizza">🍕</label>
                                
                                <input type="radio" name="groupIcon" value="⚽" id="icon-soccer" />
                                <label for="icon-soccer">⚽</label>
                                
                                <input type="radio" name="groupIcon" value="🎓" id="icon-graduation" />
                                <label for="icon-graduation">🎓</label>
                                
                                <input type="radio" name="groupIcon" value="🏖️" id="icon-beach" />
                                <label for="icon-beach">🏖️</label>
                                
                                <input type="radio" name="groupIcon" value="🚗" id="icon-car" />
                                <label for="icon-car">🚗</label>
                                
                                <input type="radio" name="groupIcon" value="🎸" id="icon-guitar" />
                                <label for="icon-guitar">🎸</label>
                                
                                <input type="radio" name="groupIcon" value="💎" id="icon-diamond" />
                                <label for="icon-diamond">💎</label>
                            </div>
                        </div>

                        <!-- Description -->
                        <div class="form-field">
                            <label for="fundDescription">
                                <span data-i18n="app.createFund.fields.description">Description</span>
                                <span class="optional" data-i18n="app.createFund.fields.budgetBadge">Optional</span>
                            </label>
                            <textarea 
                                id="fundDescription" 
                                rows="2" 
                                data-i18n-placeholder="app.createFund.fields.descriptionPlaceholder"
                                placeholder="E.g: Shared expenses for our trip"
                            ></textarea>
                        </div>
                        
                        <!-- Preferred Currency -->
                        <div class="form-field">
                            <label for="preferredCurrency">
                                <span data-i18n="app.createFund.fields.preferredCurrency">Default Currency</span>
                                <span class="optional" data-i18n="app.createFund.fields.budgetBadge">Optional</span>
                            </label>
                            <select id="preferredCurrency">
                                <option value="NONE" data-i18n="app.createFund.fields.currencyNone">None (select per expense)</option>
                                <option value="USD">🇺🇸 USD - US Dollar</option>
                                <option value="EUR">🇪🇺 EUR - Euro</option>
                                <option value="GBP">🇬🇧 GBP - British Pound</option>
                                <option value="MXN">🇲🇽 MXN - Mexican Peso</option>
                                <option value="CAD">🇨🇦 CAD - Canadian Dollar</option>
                                <option value="AUD">🇦🇺 AUD - Australian Dollar</option>
                                <option value="JPY">🇯🇵 JPY - Japanese Yen</option>
                                <option value="CNY">🇨🇳 CNY - Chinese Yuan</option>
                                <option value="INR">🇮🇳 INR - Indian Rupee</option>
                                <option value="BRL">🇧🇷 BRL - Brazilian Real</option>
                                <option value="ARS">🇦🇷 ARS - Argentine Peso</option>
                                <option value="COP">🇨🇴 COP - Colombian Peso</option>
                                <option value="CLP">🇨🇱 CLP - Chilean Peso</option>
                            </select>
                        </div>
                        
                        <!-- Hidden fields with default values -->
                        <input type="hidden" id="isPrivate" value="true" />
                        <input type="hidden" id="fundType" value="0" />
                        <input type="hidden" name="groupMode" value="simple" />
                        <input type="hidden" id="approvalPercentage" value="60" />
                        <input type="hidden" id="minimumVotes" value="2" />
                        
                        <!-- Buttons -->
                        <div class="form-actions">
                            <button type="button" class="btn-cancel" onclick="closeCreateFundModal()" data-i18n="app.createFund.buttons.cancel">
                                Cancel
                            </button>
                            <button type="submit" class="btn-create">
                                <span>🚀</span>
                                <span data-i18n="app.createFund.buttons.create">Create Group</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </main>

    <!-- Smart Settlements Modal -->
    <div id="smartSettlementsModal" class="modal-overlay" style="display: none;" onclick="closeSmartSettlements(event)">
        <div class="modal-content smart-settlements-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3>🎯 <span data-i18n="app.groups.balances.smartSettlements">Smart Settlements</span></h3>
                <button class="close-btn" onclick="closeSmartSettlements()" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settlements-intro">
                    <p class="settlements-description" data-i18n="app.groups.balances.settlementsDescription">
                        💡 We've optimized your payments to minimize the number of transactions needed to settle all debts.
                    </p>
                    <div class="settlements-stats">
                        <div class="stat-badge">
                            <span class="stat-number" id="settlementsCount">0</span>
                            <span class="stat-label" data-i18n="app.groups.balances.settlementsPaymentsNeeded">payments needed</span>
                        </div>
                        <div class="stat-badge">
                            <span class="stat-number" id="settlementsTotal">$0</span>
                            <span class="stat-label" data-i18n="app.groups.balances.settlementsTotalToSettle">total to settle</span>
                        </div>
                    </div>
                </div>
                
                <div id="settlementsList" class="settlements-list">
                    <!-- Settlements will be rendered here -->
                </div>
                
                <div id="noSettlements" class="empty-state">
                    <div class="empty-icon">✅</div>
                    <h4 data-i18n="app.groups.balances.settlementsAllSettled">All Settled!</h4>
                    <p data-i18n="app.groups.balances.settlementsNoPayments">Everyone is even. No payments needed.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSmartSettlements()">
                    <span data-i18n="app.fundDetail.close">Close</span>
                </button>
                <button class="btn btn-success" id="markAllSettledBtn" onclick="markAllSettled()" style="display: none;">
                    <span class="btn-icon">✓</span>
                    <span data-i18n="app.groups.balances.settlementsMarkAllSettled">Mark All as Settled</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Payment Method Selection Modal -->
    <div id="paymentMethodModal" class="modal-overlay" style="display: none;" onclick="closePaymentMethodModal(event)">
        <div class="modal-content payment-method-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3>💳 <span data-i18n="app.settlements.paymentMethod.title">How will you pay?</span></h3>
                <button class="close-btn" onclick="closePaymentMethodModal()" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="payment-info-summary" id="paymentInfoSummary">
                    <!-- Filled dynamically -->
                </div>
                
                <div class="payment-methods-grid">
                    <button class="payment-method-btn" onclick="selectPaymentMethod('bizum')">
                        <span class="payment-icon">📱</span>
                        <span class="payment-name">Bizum</span>
                    </button>
                    <button class="payment-method-btn" onclick="selectPaymentMethod('paypal')">
                        <span class="payment-icon">🅿️</span>
                        <span class="payment-name">PayPal</span>
                    </button>
                    <button class="payment-method-btn" onclick="selectPaymentMethod('venmo')">
                        <span class="payment-icon">💸</span>
                        <span class="payment-name">Venmo</span>
                    </button>
                    <button class="payment-method-btn" onclick="selectPaymentMethod('bank')">
                        <span class="payment-icon">🏦</span>
                        <span class="payment-name" data-i18n="app.settlements.paymentMethod.bank">Bank Transfer</span>
                    </button>
                    <button class="payment-method-btn" onclick="selectPaymentMethod('cash')">
                        <span class="payment-icon">💵</span>
                        <span class="payment-name" data-i18n="app.settlements.paymentMethod.cash">Cash</span>
                    </button>
                    <button class="payment-method-btn" onclick="selectPaymentMethod('other')">
                        <span class="payment-icon">💱</span>
                        <span class="payment-name" data-i18n="app.settlements.paymentMethod.other">Other</span>
                    </button>
                </div>
                
                <div class="payment-quick-actions" id="paymentQuickActions" style="display: none;">
                    <button class="quick-action-btn copy-btn" id="copyPaymentInfoBtn" onclick="copyPaymentInfo()">
                        <span class="btn-icon">📋</span>
                        <span data-i18n="app.settlements.actions.copyInfo">Copy Payment Info</span>
                    </button>
                    <button class="quick-action-btn remind-btn" id="sendReminderBtn" onclick="sendPaymentReminder()">
                        <span class="btn-icon">🔔</span>
                        <span data-i18n="app.settlements.actions.sendReminder">Send Reminder</span>
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePaymentMethodModal()">
                    <span data-i18n="common.cancel">Cancel</span>
                </button>
                <button class="btn btn-success" id="confirmPaymentBtn" onclick="confirmSettlementWithMethod()" disabled>
                    <span class="btn-icon">✓</span>
                    <span data-i18n="app.settlements.actions.markPaid">Mark as Paid</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Quick Add FAB (Floating Action Button) -->
    <div id="quickAddFab" class="quick-add-fab" style="display: none;">
        <button class="fab-trigger" onclick="toggleQuickAdd()" aria-label="Quick add expense">
            <span class="fab-icon">+</span>
        </button>
        <div class="fab-form" id="fabForm" style="display: none;">
            <div class="fab-header">
                <span data-i18n="app.personalColony.quickAdd">Quick Add</span>
                <button class="fab-close" onclick="toggleQuickAdd()" aria-label="Close">×</button>
            </div>
            <div class="fab-field">
                <div class="fab-amount-wrapper">
                    <span class="fab-currency-symbol">$</span>
                    <input type="number" id="fabAmount" placeholder="0.00" inputmode="decimal" step="0.01" min="0">
                </div>
                <select id="fabCurrency" class="fab-currency-select">
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                    <option value="MXN">MXN</option>
                    <option value="COP">COP</option>
                    <option value="GBP">GBP</option>
                </select>
            </div>
            <div class="fab-field">
                <select id="fabCategory" class="fab-select">
                    <option value="food">🍔 Food</option>
                    <option value="transport">🚗 Transport</option>
                    <option value="entertainment">🎬 Entertainment</option>
                    <option value="shopping">🛍️ Shopping</option>
                    <option value="bills">💳 Bills</option>
                    <option value="utilities">🔧 Utilities</option>
                    <option value="health">⚕️ Health</option>
                    <option value="housing">🏠 Housing</option>
                    <option value="subscriptions">📱 Subscriptions</option>
                    <option value="education">🎓 Education</option>
                    <option value="personal">💅 Personal</option>
                    <option value="other">📦 Other</option>
                </select>
            </div>
            <div class="fab-field">
                <input type="text" id="fabDescription" class="fab-input" placeholder="Description (optional)" data-i18n-placeholder="expense.descriptionPlaceholder">
            </div>
            <!-- Shared expense toggle -->
            <div class="fab-shared-toggle">
                <label class="toggle-label">
                    <span data-i18n="app.sharedExpense.toggle">Shared expense?</span>
                    <div class="toggle-switch">
                        <input type="checkbox" id="fabSharedToggle" onchange="toggleFabSharedOptions()">
                        <span class="toggle-slider"></span>
                    </div>
                </label>
            </div>
            <div id="fabSharedOptions" class="fab-shared-options" style="display: none;">
                <select id="fabTargetGroup" class="fab-select">
                    <option value="" data-i18n="app.sharedExpense.selectGroup">Select group...</option>
                </select>
                <button class="fab-link-btn" onclick="showCreateGroupFromFab()">
                    + <span data-i18n="app.sharedExpense.createGroup">Create new group</span>
                </button>
            </div>
            <div class="fab-actions">
                <button class="fab-btn fab-btn-save" onclick="quickAddExpense()">
                    <span class="fab-btn-icon">✓</span>
                    <span data-i18n="common.save">Save</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="i18n.js?v=2.0.0"></script>
    <script src="theme.js"></script>
    <script src="ethers.umd.min.js"></script>
    
    <!-- Stripe SDK -->
    <script async src="https://js.stripe.com/v3/buy-button.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-messaging-compat.js"></script>
    
    <!-- App Scripts -->
    <script src="firebase-config.js"></script>
    <script src="firebase-messaging.js"></script>
    
    <!-- Security Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    <script src="security-wrapper.js"></script>
    <script src="rate-limiter.js"></script>
    <script src="sanitizer.js"></script>
    
    <!-- Application Scripts -->
    <script src="haptic-feedback.js?v=1.0"></script>
    <script src="mode-manager.js"></script>
    <script src="wallet-connector.js"></script>
    <script src="form-wizard.js"></script>
    <script src="colony-system.js?v=1.7"></script>
    <script src="mascot-system.js?v=1.9"></script>
    <script src="app-platform.js?v=3.6"></script>
    
    <script>
        // Mark that user has used the app (for redirect from landing page)
        localStorage.setItem('antpool_has_used_app', 'true');
        
        // Mode Selector Interaction
        document.addEventListener('DOMContentLoaded', () => {
            const modeRadios = document.querySelectorAll('input[name="groupMode"]');
            const modeInfoBox = document.getElementById('modeInfoBox');
            
            modeRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const selectedMode = e.target.value;
                    
                    if (selectedMode === 'simple') {
                        modeInfoBox.innerHTML = `
                            <div class="info-icon">💡</div>
                            <div class="info-content">
                                <strong>Simple Mode:</strong> Perfect for getting started. No crypto knowledge needed. You can upgrade to Blockchain Mode later if you want automatic payments.
                            </div>
                        `;
                    } else {
                        modeInfoBox.innerHTML = `
                            <div class="info-icon">⚠️</div>
                            <div class="info-content">
                                <strong>Blockchain Mode:</strong> Requires a wallet (MetaMask) and ETH for gas fees. Payments are automatic and trustless. Once created, the group cannot be converted to Simple Mode.
                            </div>
                        `;
                    }
                });
            });
            
            // Initialize Firebase when page loads
            if (typeof window.FirebaseConfig !== 'undefined') {
                window.FirebaseConfig.initialize().then(success => {
                    if (success) {
                        // Show BETA modal after Firebase is ready
                        checkAndShowBetaModal();
                    } else {
                        console.warn('⚠️ Firebase initialization failed - Simple Mode unavailable');
                    }
                });
            }
        });
        
        // ============================================================================
        // BETA LAUNCH MODAL FUNCTIONS
        // ============================================================================
        
        function checkAndShowBetaModal() {
            const dontShowAgain = localStorage.getItem('antpool_beta_modal_dismissed');
            if (!dontShowAgain) {
                // Small delay to let the page fully load
                setTimeout(() => {
                    showBetaModal();
                }, 1000);
            }
        }
        
        function showBetaModal() {
            const modal = document.getElementById('betaLaunchModal');
            if (modal) {
                modal.style.display = 'flex';
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }
        
        function closeBetaModal() {
            const modal = document.getElementById('betaLaunchModal');
            const dontShowCheckbox = document.getElementById('betaDontShowAgain');
            
            if (dontShowCheckbox && dontShowCheckbox.checked) {
                localStorage.setItem('antpool_beta_modal_dismissed', 'true');
            }
            
            if (modal) {
                modal.classList.remove('active');
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        }
        
        // ============================================================================
        
        // Settings Modal Functions are now in app-platform.js
        // Removed duplicate definitions to avoid conflicts

        function applyAppTranslations() {
            const currentLang = getCurrentLanguage();
            const t = translations[currentLang];
            
            // Update document title
            document.title = `Ant Pool - ${t.app.header.subtitle}`;
            
            // Header
            const versionBadge = document.querySelector('.version-badge');
            if (versionBadge) versionBadge.textContent = t.app.header.subtitle;
            
            // Connect/Disconnect buttons
            const connectBtn = document.querySelector('#connectWallet span:last-child');
            if (connectBtn) connectBtn.textContent = t.app.header.connect;
            
            const disconnectBtn = document.querySelector('#disconnectWallet span:last-child');
            if (disconnectBtn) disconnectBtn.textContent = t.app.header.disconnect;
            
            // Nickname Modal
            const nicknameTitle = document.querySelector('#nicknameModal h2');
            if (nicknameTitle) nicknameTitle.textContent = `👋 ${t.app.nickname.title}`;
            
            const nicknameParagraph = document.querySelector('#nicknameModal p');
            if (nicknameParagraph) nicknameParagraph.innerHTML = t.app.nickname.subtitle;
            
            const nicknameLabel = document.querySelector('#nicknameModal label');
            if (nicknameLabel) nicknameLabel.textContent = t.app.nickname.label;
            
            const nicknameInput = document.querySelector('#nicknameInput');
            if (nicknameInput) nicknameInput.placeholder = t.app.nickname.placeholder;
            
            const nicknameSmall = document.querySelector('#nicknameModal small');
            if (nicknameSmall) nicknameSmall.textContent = t.app.nickname.help;
            
            const nicknameBtn = document.querySelector('#setNicknameBtn');
            if (nicknameBtn) nicknameBtn.textContent = t.app.nickname.button;
            
            // Stats
            const statCards = document.querySelectorAll('.stat-card p');
            if (statCards[0]) statCards[0].textContent = t.app.stats.groupsCreated;
            if (statCards[1]) statCards[1].textContent = t.app.stats.activeGroups;
            if (statCards[2]) statCards[2].textContent = t.app.stats.groupsJoined;
            
            // Invitations
            const invitationsTitle = document.querySelector('.invitations-header h3');
            if (invitationsTitle) invitationsTitle.textContent = `🎫 ${t.app.invitations.title}`;
            
            // Dashboard
            const dashboardTitle = document.querySelector('.action-bar h2');
            if (dashboardTitle) dashboardTitle.textContent = t.app.dashboard.title;
            
            const createBtn = document.querySelector('#createFundBtn span:last-child');
            if (createBtn) createBtn.textContent = t.app.dashboard.createNew;
            
            // Filters are now handled by data-i18n attributes - no manual translation needed
            
            // Empty State
            const emptyTitle = document.querySelector('#emptyState h3');
            if (emptyTitle) emptyTitle.textContent = t.app.dashboard.empty.title;
            
            const emptySubtitle = document.querySelector('#emptyState p');
            if (emptySubtitle) emptySubtitle.textContent = t.app.dashboard.empty.subtitle;
            
            const emptyBtn = document.querySelector('#emptyState button span:last-child');
            if (emptyBtn) emptyBtn.textContent = t.app.dashboard.empty.button;
            
            // Back button
            const backBtn = document.querySelector('#backToDashboard span:last-child');
            if (backBtn) backBtn.textContent = t.app.fundDetail.info.backToDashboard;
            
            // Fund Detail Stats - Using data-i18n instead of manual assignment
            // The stat labels in the header are now handled by data-i18n attributes
            
            // Fund Detail Loading and Badges
            const fundDetailName = document.querySelector('#fundDetailName');
            if (fundDetailName && fundDetailName.textContent === 'Cargando...') {
                fundDetailName.textContent = t.app.fundDetail.info.loading;
            }
            
            const fundTypeBadge = document.querySelector('#fundTypeBadge');
            if (fundTypeBadge && fundTypeBadge.textContent === 'Tipo') {
                fundTypeBadge.textContent = t.app.fundDetail.info.type;
            }
            
            const groupStatusBadge = document.querySelector('#groupStatusBadge');
            if (groupStatusBadge && groupStatusBadge.textContent === 'Estado') {
                groupStatusBadge.textContent = t.app.fundDetail.info.status;
            }
            
            // Fund Tabs
            const tabButtons = document.querySelectorAll('.fund-tab-btn');
            tabButtons.forEach(btn => {
                const tabId = btn.dataset.tab;
                const span = btn.querySelector('span:last-child');
                if (span && t.app.fundDetail.tabs[tabId]) {
                    span.textContent = t.app.fundDetail.tabs[tabId];
                }
            });
            
            // Deposit Tab
            const depositTitle = document.querySelector('#depositTab h3');
            if (depositTitle) depositTitle.textContent = `💰 ${t.app.fundDetail.deposit.title}`;
            
            const depositSubtitle = document.querySelector('#depositTab p');
            if (depositSubtitle) depositSubtitle.textContent = t.app.fundDetail.deposit.subtitle;
            
            const depositLabel = document.querySelector('label[for="depositAmount"]');
            if (depositLabel) depositLabel.textContent = t.app.fundDetail.deposit.amount;
            
            const depositInput = document.querySelector('#depositAmount');
            if (depositInput) depositInput.placeholder = t.app.fundDetail.deposit.amountPlaceholder;
            
            const depositContribution = document.querySelector('.contribution-info span');
            if (depositContribution && depositContribution.textContent.includes('contribución')) {
                depositContribution.innerHTML = `${t.app.fundDetail.deposit.currentContribution}: <strong id="userContribution">0 ETH</strong>`;
            }
            
            const depositBtn = document.querySelector('#depositBtn');
            if (depositBtn) depositBtn.textContent = t.app.fundDetail.deposit.button;
            
            // Manage Tab
            const manageTitle = document.querySelector('#manageTab h3');
            if (manageTitle) manageTitle.textContent = `⚙️ ${t.app.fundDetail.manage.title}`;
            
            const manageSubtitle = document.querySelector('#manageTab > .tab-card > p');
            if (manageSubtitle) manageSubtitle.textContent = t.app.fundDetail.manage.subtitle;
            
            const memberManagementTitle = document.querySelector('.member-management-section h4');
            if (memberManagementTitle) memberManagementTitle.textContent = `👥 ${t.app.fundDetail.manage.memberManagement}`;
            
            const kickMemberTitle = document.querySelector('.member-management-section p strong');
            if (kickMemberTitle) kickMemberTitle.textContent = t.app.fundDetail.manage.kickMember;
            
            const kickDescription = document.querySelector('.member-management-section .help-text');
            if (kickDescription) kickDescription.textContent = t.app.fundDetail.manage.kickDescription;
            
            const howItWorksTitle = document.querySelector('.member-management-section .info-box p strong');
            if (howItWorksTitle) howItWorksTitle.textContent = `💡 ${t.app.fundDetail.manage.howItWorks}`;
            

            
            const noMembersTitle = document.querySelector('#noMembersToKick h4');
            if (noMembersTitle) noMembersTitle.textContent = t.app.fundDetail.manage.noMembersToKick;
            
            const noMembersSubtitle = document.querySelector('#noMembersToKick p');
            if (noMembersSubtitle) noMembersSubtitle.textContent = t.app.fundDetail.manage.noMembersSubtitle;
            
            const dangerZoneTitle = document.querySelector('.danger-zone h4');
            if (dangerZoneTitle) dangerZoneTitle.textContent = `🚨 ${t.app.fundDetail.manage.dangerZone}`;
            
            const closeDistributeTitle = document.querySelector('.danger-zone > p strong');
            if (closeDistributeTitle) closeDistributeTitle.textContent = t.app.fundDetail.manage.closeAndDistribute;
            
            const closeDescription = document.querySelector('.danger-zone > .help-text');
            if (closeDescription) closeDescription.textContent = t.app.fundDetail.manage.closeDescription;
            
            const warningTitle = document.querySelector('.warning-box p strong');
            if (warningTitle) warningTitle.textContent = `⚠️ ${t.app.fundDetail.manage.warning}`;
            

            
            const distributionPreviewTitle = document.querySelector('#closeFundPreview h5');
            if (distributionPreviewTitle) distributionPreviewTitle.textContent = `📊 ${t.app.fundDetail.manage.distributionPreview}`;
            
            const previewButton = document.querySelector('#previewCloseFundBtn');
            if (previewButton) previewButton.textContent = `📊 ${t.app.fundDetail.manage.previewButton}`;
            
            const closeButton = document.querySelector('#closeFundBtn');
            if (closeButton) closeButton.textContent = `🔒 ${t.app.fundDetail.manage.closeButton}`;
            
            // Invite Tab
            const inviteTitle = document.querySelector('#inviteTab h3');
            if (inviteTitle) inviteTitle.textContent = `🎫 ${t.app.fundDetail.invite.title}`;
            
            const inviteSubtitle = document.querySelector('#inviteTab > .tab-card > p');
            if (inviteSubtitle) inviteSubtitle.textContent = t.app.fundDetail.invite.subtitle;
            
            const inviteInfoTitle = document.querySelector('.invite-info-box p strong');
            if (inviteInfoTitle) inviteInfoTitle.textContent = `ℹ️ ${t.app.fundDetail.invite.infoTitle}`;
            
            // inviteInfoPoints - check if they exist before mapping
            const inviteInfoList = document.querySelector('.invite-info-box ul');
            if (inviteInfoList && t.app.fundDetail.invite.infoPoints) {
                inviteInfoList.innerHTML = t.app.fundDetail.invite.infoPoints.map(point => `<li>${point}</li>`).join('');
            }
            
            const inviteLabel = document.querySelector('label[for="inviteAddress"]');
            if (inviteLabel) inviteLabel.textContent = t.app.fundDetail.invite.addressLabel;
            
            const inviteInput = document.querySelector('#inviteAddress');
            if (inviteInput) inviteInput.placeholder = t.app.fundDetail.invite.addressPlaceholder;
            
            const inviteHelp = document.querySelector('#inviteTab small');
            if (inviteHelp) inviteHelp.textContent = t.app.fundDetail.invite.addressHelp;
            
            const inviteBtn = document.querySelector('#inviteBtn');
            if (inviteBtn) inviteBtn.textContent = t.app.fundDetail.invite.button;
            
            // Propose Tab
            const proposeTitle = document.querySelector('#proposeTab h3');
            if (proposeTitle) proposeTitle.textContent = `📝 ${t.app.fundDetail.propose.title}`;
            
            const proposeSubtitle = document.querySelector('#proposeTab > .tab-card > p');
            if (proposeSubtitle) proposeSubtitle.textContent = t.app.fundDetail.propose.subtitle;
            
            const proposeHowItWorks = document.querySelector('#proposeTab .info-box p strong');
            if (proposeHowItWorks) proposeHowItWorks.textContent = `💡 ${t.app.fundDetail.propose.howItWorks}`;
            
            const proposeHowItWorksList = document.querySelector('#proposeTab .info-box ul');
            if (proposeHowItWorksList) {
                proposeHowItWorksList.innerHTML = t.app.fundDetail.propose.howItWorksPoints.map(point => `<li>${point}</li>`).join('');
            }
            
            const proposeRecipientLabel = document.querySelector('label[for="proposalRecipient"]');
            if (proposeRecipientLabel) proposeRecipientLabel.textContent = t.app.fundDetail.propose.recipientLabel;
            
            const proposeRecipientInput = document.querySelector('#proposalRecipient');
            if (proposeRecipientInput) proposeRecipientInput.placeholder = t.app.fundDetail.propose.recipientPlaceholder;
            
            const proposeRecipientHelp = document.querySelector('label[for="proposalRecipient"] + input + small');
            if (proposeRecipientHelp) proposeRecipientHelp.textContent = t.app.fundDetail.propose.recipientHelp;
            
            const proposeAmountLabel = document.querySelector('label[for="proposalAmount"]');
            if (proposeAmountLabel) proposeAmountLabel.textContent = t.app.fundDetail.propose.amountLabel;
            
            const proposeAmountInput = document.querySelector('#proposalAmount');
            if (proposeAmountInput) proposeAmountInput.placeholder = t.app.fundDetail.propose.amountPlaceholder;
            
            const proposeAmountHelp = document.querySelector('label[for="proposalAmount"] + input + small');
            if (proposeAmountHelp) proposeAmountHelp.textContent = t.app.fundDetail.propose.amountHelp;
            
            const proposeDescLabel = document.querySelector('label[for="proposalDescription"]');
            if (proposeDescLabel) proposeDescLabel.textContent = t.app.fundDetail.propose.descriptionLabel;
            
            const proposeDescInput = document.querySelector('#proposalDescription');
            if (proposeDescInput) proposeDescInput.placeholder = t.app.fundDetail.propose.descriptionPlaceholder;
            
            const proposeDescHelp = document.querySelector('label[for="proposalDescription"] + textarea + small');
            if (proposeDescHelp) proposeDescHelp.textContent = t.app.fundDetail.propose.descriptionHelp;
            
            const proposeBtn = document.querySelector('#createProposalBtn');
            if (proposeBtn) proposeBtn.textContent = `📝 ${t.app.fundDetail.propose.button}`;
            
            // Propose Tab - Member Selection
            const involvedMembersLabel = document.querySelector('label[for="involvedMembers"]');
            if (involvedMembersLabel) involvedMembersLabel.textContent = t.app.fundDetail.propose.involvedMembersLabel;
            
            const selectAllMembersBtn = document.getElementById('selectAllMembersBtn');
            if (selectAllMembersBtn) selectAllMembersBtn.textContent = `✓ ${t.app.fundDetail.propose.selectAllMembers}`;
            
            const deselectAllMembersBtn = document.getElementById('deselectAllMembersBtn');
            if (deselectAllMembersBtn) deselectAllMembersBtn.textContent = `✗ ${t.app.fundDetail.propose.deselectAllMembers}`;
            
            const involvedMembersHelp = document.querySelector('#proposeTab .form-group small:last-of-type');
            if (involvedMembersHelp) involvedMembersHelp.textContent = t.app.fundDetail.propose.involvedMembersHelp;
            
            // Vote Tab
            const voteTitle = document.querySelector('#voteTab h3');
            if (voteTitle) voteTitle.textContent = `🗳️ ${t.app.fundDetail.vote.title}`;
            
            const voteDescription = document.querySelector('#voteTab .tab-description');
            if (voteDescription) voteDescription.textContent = t.app.fundDetail.vote.description;
            
            const noProposalsTitle = document.querySelector('#noProposals h4');
            if (noProposalsTitle) noProposalsTitle.textContent = t.app.fundDetail.vote.noProposals;
            
            const noProposalsSubtitle = document.querySelector('#noProposals p');
            if (noProposalsSubtitle) noProposalsSubtitle.textContent = t.app.fundDetail.vote.noProposalsSubtitle;
            
            // History Tab
            const historyTitle = document.querySelector('#historyTab h3');
            if (historyTitle) historyTitle.textContent = `📜 ${t.app.fundDetail.history.title}`;
            
            const historyDescription = document.querySelector('#historyTab .tab-description');
            if (historyDescription) historyDescription.textContent = t.app.fundDetail.history.description;
            
            const noHistoryTitle = document.querySelector('#noHistory h4');
            if (noHistoryTitle) noHistoryTitle.textContent = t.app.fundDetail.history.empty;
            
            const noHistorySubtitle = document.querySelector('#noHistory p');
            if (noHistorySubtitle) noHistorySubtitle.textContent = t.app.fundDetail.history.emptySubtitle;
            
            // Balances Tab
            const balancesTitle = document.querySelector('#balancesTab h3');
            if (balancesTitle) balancesTitle.textContent = `⚖️ ${t.app.fundDetail.balances.title}`;
            
            const balancesDescription = document.querySelector('#balancesTab .tab-description');
            if (balancesDescription) balancesDescription.textContent = t.app.fundDetail.balances.description;
            
            const totalContributedLabel = document.querySelectorAll('.balance-stat-label')[0];
            if (totalContributedLabel) totalContributedLabel.textContent = t.app.fundDetail.balances.totalContributions;
            
            const totalSpentLabel = document.querySelectorAll('.balance-stat-label')[1];
            if (totalSpentLabel) totalSpentLabel.textContent = t.app.fundDetail.balances.totalExpenses;
            
            const availableBalanceLabel = document.querySelectorAll('.balance-stat-label')[2];
            if (availableBalanceLabel) availableBalanceLabel.textContent = t.app.fundDetail.balances.currentBalance;
            
            const balancesHowItWorks = document.querySelector('#balancesTab .info-box p strong');
            if (balancesHowItWorks) balancesHowItWorks.textContent = `💡 ${t.app.fundDetail.balances.howItWorks}`;
            
            // howItWorksPoints now handled by data-i18n attributes in HTML
            
            const noBalancesTitle = document.querySelector('#noBalances h4');
            if (noBalancesTitle) noBalancesTitle.textContent = t.app.fundDetail.balances.empty;
            
            const noBalancesSubtitle = document.querySelector('#noBalances p');
            if (noBalancesSubtitle) noBalancesSubtitle.textContent = t.app.fundDetail.balances.emptySubtitle;
            
            // QR Scanner Modal
            const qrScannerTitle = document.querySelector('#qrScannerTitle');
            if (qrScannerTitle) qrScannerTitle.textContent = `📷 ${t.app.fundDetail.qrScanner.title}`;
            
            const qrWarningTitle = document.querySelector('#qrWarningTitle');
            if (qrWarningTitle) qrWarningTitle.textContent = `⚠️ ${t.app.fundDetail.qrScanner.warning}`;
            
            // Translate qrWarningList
            const qrWarningList = document.querySelector('#qrWarningList');
            if (qrWarningList) {
                qrWarningList.innerHTML = t.app.fundDetail.qrScanner.warningPoints.map(point => {
                    // Add bold to important parts
                    return `<li>${point}</li>`;
                }).join('');
            }
            
            const qrDetectedLabel = document.querySelector('#qrDetectedLabel');
            if (qrDetectedLabel) qrDetectedLabel.textContent = `✅ ${t.app.fundDetail.qrScanner.detected}`;
            
            const qrFinalConfirmTitle = document.querySelector('#qrFinalConfirmTitle');
            if (qrFinalConfirmTitle) qrFinalConfirmTitle.textContent = `🚨 ${t.app.fundDetail.qrScanner.finalConfirmation}`;
            
            const qrConfirmationText = document.querySelector('#qrConfirmationText');
            if (qrConfirmationText) qrConfirmationText.textContent = t.app.fundDetail.qrScanner.confirmationText;
            
            const qrConfirmationList = document.querySelector('#qrConfirmationList');
            if (qrConfirmationList) {
                qrConfirmationList.innerHTML = t.app.fundDetail.qrScanner.confirmationPoints.map(point => {
                    if (point.includes('Base blockchain')) {
                        return `<li>${point.replace('Base blockchain', '<strong>Base blockchain</strong>')}</li>`;
                    }
                    if (point.includes('blockchain de Base')) {
                        return `<li>${point.replace('blockchain de Base', '<strong>blockchain de Base</strong>')}</li>`;
                    }
                    if (point.includes('cannot be recovered') || point.includes('no pueden recuperarse')) {
                        return `<li>${point.replace('cannot be recovered', '<strong>cannot be recovered</strong>').replace('no pueden recuperarse', '<strong>no pueden recuperarse</strong>')}</li>`;
                    }
                    return `<li>${point}</li>`;
                }).join('');
            }
            
            const qrCheckboxLabel = document.querySelector('#qrCheckboxLabel');
            if (qrCheckboxLabel) qrCheckboxLabel.textContent = t.app.fundDetail.qrScanner.checkboxLabel;
            
            const confirmQRBtn = document.querySelector('#confirmQRBtn');
            if (confirmQRBtn) confirmQRBtn.innerHTML = `✓ ${t.app.fundDetail.qrScanner.confirmButton}`;
            
            const qrCancelBtn2 = document.querySelector('#qrCancelBtn2');
            if (qrCancelBtn2) qrCancelBtn2.textContent = t.app.fundDetail.qrScanner.cancelButton;
            
            const cancelScanBtn = document.querySelector('#cancelScanBtn');
            if (cancelScanBtn) cancelScanBtn.textContent = t.app.fundDetail.qrScanner.cancelScan;
            
            // Create Fund Modal
            const createFundTitle = document.querySelector('#createFundModal h2');
            if (createFundTitle) createFundTitle.textContent = `✨ ${t.app.createFund.title}`;
            
            // Section headers
            // Section headers (removed fund type and privacy sections)
            // No section headers to translate now
            
            // Form fields
            const fundNameLabel = document.querySelector('label[for="fundName"] .label-text');
            if (fundNameLabel) fundNameLabel.textContent = t.app.createFund.fields.name;
            
            const fundNameInput = document.querySelector('#fundName');
            if (fundNameInput) fundNameInput.placeholder = t.app.createFund.fields.namePlaceholder;
            
            const fundDescLabel = document.querySelector('label[for="fundDescription"] .label-text');
            if (fundDescLabel) fundDescLabel.textContent = t.app.createFund.fields.description;
            
            const fundDescInput = document.querySelector('#fundDescription');
            if (fundDescInput) fundDescInput.placeholder = t.app.createFund.fields.descriptionPlaceholder;
            
            // Voting fields
            const approvalLabel = document.querySelector('label[for="approvalPercentage"] .label-text');
            if (approvalLabel) approvalLabel.textContent = t.app.createFund.fields.approvalPercentage;
            
            const approvalParent = document.querySelector('label[for="approvalPercentage"]');
            if (approvalParent) {
                const approvalHint = approvalParent.parentElement.querySelector('.form-hint');
                if (approvalHint) approvalHint.textContent = t.app.createFund.fields.approvalHint;
            }
            
            const minimumVotesLabel = document.querySelector('label[for="minimumVotes"] .label-text');
            if (minimumVotesLabel) minimumVotesLabel.textContent = t.app.createFund.fields.minimumVotes;
            
            const minimumVotesParent = document.querySelector('label[for="minimumVotes"]');
            if (minimumVotesParent) {
                const minimumVotesHint = minimumVotesParent.parentElement.querySelector('.form-hint');
                if (minimumVotesHint) minimumVotesHint.textContent = t.app.createFund.fields.minimumVotesHint;
            }
            
            // Buttons
            const cancelCreateBtn = document.querySelector('#createFundModal .btn-secondary');
            if (cancelCreateBtn) cancelCreateBtn.textContent = t.app.createFund.buttons.cancel;
            
            const createSubmitBtn = document.querySelector('#createFundModal .btn-primary[type="submit"]');
            if (createSubmitBtn) createSubmitBtn.innerHTML = `🚀 ${t.app.createFund.buttons.create}`;
        }

        function updateAppSettingsUI() {
            const currentLang = getCurrentLanguage();
            const currentTheme = getCurrentTheme();
            const settings = translations[currentLang].settings;
            
            // Update settings title
            const settingsTitleText = document.querySelector('#appSettingsModal .settings-title-text');
            if (settingsTitleText) settingsTitleText.textContent = settings.title;
            
            // Update language buttons
            document.querySelectorAll('[data-lang]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === currentLang);
            });
            
            // Update theme buttons
            document.querySelectorAll('[data-theme]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.theme === currentTheme);
            });
        }

        // Initialize settings UI on load
        document.addEventListener('DOMContentLoaded', () => {
            applyAppTranslations();
            updateAppSettingsUI();
        });
    </script>

    <!-- Recurring Expense Modal -->
    <div id="recurringExpenseModal" class="modal" style="display: none;">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h2>🔄 Create Recurring Expense</h2>
                <button class="modal-close" onclick="closeRecurringExpenseModal()">&times;</button>
            </div>
            
            <form id="recurringExpenseForm" class="expense-form-clean">
                <div class="form-header-clean">
                    <h3>Automate Regular Expenses</h3>
                    <p style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">
                        Perfect for rent, utilities, subscriptions, or any expense that repeats regularly.
                    </p>
                </div>

                <div class="form-grid">
                    <div class="form-field">
                        <label for="recurringDescription" class="form-label">Description *</label>
                        <input 
                            type="text" 
                            id="recurringDescription"
                            class="form-input"
                            placeholder="e.g., Monthly Rent, Netflix, Groceries"
                            required
                        >
                    </div>

                    <div class="form-field">
                        <label for="recurringAmount" class="form-label">Amount *</label>
                        <div class="amount-input-wrapper">
                            <span class="currency-symbol" id="recurringCurrencySymbol">$</span>
                            <input 
                                type="number" 
                                id="recurringAmount"
                                class="form-input amount-input"
                                placeholder="0.00"
                                step="any"
                                required
                            >
                        </div>
                    </div>

                    <div class="form-field">
                        <label for="recurringCurrency" class="form-label">Currency</label>
                        <select id="recurringCurrency" class="form-input form-select" onchange="updateRecurringCurrencySymbol()">
                            <option value="USD" selected>🇺🇸 USD</option>
                            <option value="EUR">🇪🇺 EUR</option>
                            <option value="GBP">🇬🇧 GBP</option>
                            <option value="MXN">🇲🇽 MXN</option>
                            <option value="COP">🇨🇴 COP</option>
                            <option value="BRL">🇧🇷 BRL</option>
                        </select>
                    </div>

                    <div class="form-field">
                        <label for="recurringCategory" class="form-label">Category</label>
                        <select id="recurringCategory" class="form-input form-select">
                            <option value="food">🍕 Food & Dining</option>
                            <option value="transport">🚗 Transportation</option>
                            <option value="housing" selected>🏠 Housing & Rent</option>
                            <option value="utilities">💡 Utilities</option>
                            <option value="entertainment">🎬 Entertainment</option>
                            <option value="shopping">🛍️ Shopping</option>
                            <option value="health">⚕️ Health & Medical</option>
                            <option value="travel">✈️ Travel</option>
                            <option value="subscription">📺 Subscriptions</option>
                            <option value="other">🎯 Other</option>
                        </select>
                    </div>

                    <div class="form-field">
                        <label for="recurringFrequency" class="form-label">Frequency *</label>
                        <select id="recurringFrequency" class="form-input form-select" onchange="updateRecurringFrequencyOptions()">
                            <option value="daily">📅 Daily</option>
                            <option value="weekly">📆 Weekly</option>
                            <option value="monthly" selected>🗓️ Monthly</option>
                        </select>
                    </div>

                    <div class="form-field" id="dayOfMonthField">
                        <label for="recurringDayOfMonth" class="form-label">Day of Month *</label>
                        <select id="recurringDayOfMonth" class="form-input form-select">
                            <option value="1" selected>1st of month</option>
                            <option value="15">15th of month</option>
                            <option value="30">30th of month (last day for shorter months)</option>
                        </select>
                        <small class="field-hint">When should this expense be created each month?</small>
                    </div>

                    <div class="form-field" id="dayOfWeekField" style="display: none;">
                        <label for="recurringDayOfWeek" class="form-label">Day of Week *</label>
                        <select id="recurringDayOfWeek" class="form-input form-select">
                            <option value="1">Monday</option>
                            <option value="2">Tuesday</option>
                            <option value="3">Wednesday</option>
                            <option value="4">Thursday</option>
                            <option value="5">Friday</option>
                            <option value="6">Saturday</option>
                            <option value="7">Sunday</option>
                        </select>
                    </div>

                    <div class="form-field">
                        <label class="form-label">Paid by *</label>
                        <div id="recurringPaidBy" class="split-members-list">
                            <!-- Populated dynamically -->
                        </div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">Split between *</label>
                        <div class="info-box" style="margin-bottom: 0.75rem; background: rgba(99, 102, 241, 0.1); border-color: rgba(99, 102, 241, 0.3); padding: 0.75rem;">
                            <p style="margin: 0; font-size: 0.85rem; display: flex; align-items: start; gap: 0.5rem;">
                                <span style="font-size: 1rem;">💡</span>
                                <span>
                                    <strong>Flexible splitting:</strong> Use the <strong>+</strong> and <strong>−</strong> buttons to add portions when a member covers for external guests.
                                </span>
                            </p>
                        </div>
                        <div id="recurringSplitBetween" class="split-members-list">
                            <!-- Populated dynamically -->
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeRecurringExpenseModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        🔄 Create Recurring Expense
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Budget Modal -->
    <div id="budgetModal" class="modal" style="display: none;">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h2>💰 Set Group Budget</h2>
                <button class="modal-close" onclick="closeBudgetModal()">&times;</button>
            </div>
            
            <form id="budgetForm" class="expense-form-clean">
                <div class="form-header-clean" style="padding: 1rem 1.5rem 0;">
                    <p style="font-size: 0.9rem; color: rgba(255,255,255,0.7); margin: 0;">
                        Set a spending limit and get alerts when approaching it. Perfect for trips or monthly shared costs.
                    </p>
                </div>

                <div class="form-grid">
                    <div class="form-field">
                        <label for="budgetAmount" class="form-label">Budget Amount *</label>
                        <div class="amount-input-wrapper">
                            <span class="currency-symbol" id="budgetCurrencySymbol">$</span>
                            <input 
                                type="number" 
                                id="budgetAmount"
                                class="form-input amount-input"
                                placeholder="2000"
                                step="any"
                                required
                            >
                        </div>
                        <small class="field-hint">Total amount you plan to spend</small>
                    </div>

                    <div class="form-field">
                        <label for="budgetCurrency" class="form-label">Currency</label>
                        <select id="budgetCurrency" class="form-input form-select" onchange="updateBudgetCurrencySymbol()">
                            <option value="USD" selected>🇺🇸 USD</option>
                            <option value="EUR">🇪🇺 EUR</option>
                            <option value="GBP">🇬🇧 GBP</option>
                            <option value="MXN">🇲🇽 MXN</option>
                            <option value="COP">🇨🇴 COP</option>
                            <option value="BRL">🇧🇷 BRL</option>
                        </select>
                    </div>

                    <div class="form-field">
                        <label for="budgetPeriod" class="form-label">Budget Period *</label>
                        <select id="budgetPeriod" class="form-input form-select">
                            <option value="trip">🏖️ One-time (trip/event)</option>
                            <option value="monthly">📆 Monthly</option>
                            <option value="weekly">📅 Weekly</option>
                        </select>
                    </div>

                    <div class="form-field">
                        <label class="form-label">Alerts</label>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <label class="checkbox-label">
                                <input type="checkbox" id="alert50" checked>
                                <span>50%</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="alert80" checked>
                                <span>80%</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="alert100" checked>
                                <span>100%</span>
                            </label>
                        </div>
                        <small class="field-hint">Visual warnings when thresholds are reached</small>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeBudgetModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        💰 Set Budget
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Group Info Modal -->
    <div id="editGroupModal" class="modal" style="display: none;">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h2>✏️ Edit Group Info</h2>
                <button class="modal-close" onclick="closeEditGroupModal()">&times;</button>
            </div>
            
            <form id="editGroupForm" class="expense-form-clean">
                <div class="form-header-clean" style="padding: 1rem 1.5rem 0;">
                    <p style="font-size: 0.9rem; color: rgba(255,255,255,0.7); margin: 0;">
                        Update your group's icon, name, and description. Only the group creator can make these changes.
                    </p>
                </div>

                <div class="form-grid">
                    <div class="form-field">
                        <label for="editGroupIcon" class="form-label">Group Icon</label>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div id="editGroupIconPreview" style="font-size: 3rem; padding: 0.5rem;">📦</div>
                            <select id="editGroupIcon" class="form-input" onchange="updateEditGroupIconPreview()">
                                <option value="📦">📦 Box</option>
                                <option value="🌴">🌴 Palm Tree</option>
                                <option value="✈️">✈️ Airplane</option>
                                <option value="🏠">🏠 House</option>
                                <option value="🍕">🍕 Pizza</option>
                                <option value="🎉">🎉 Party</option>
                                <option value="🏖️">🏖️ Beach</option>
                                <option value="🎓">🎓 Graduation</option>
                                <option value="💼">💼 Briefcase</option>
                                <option value="🎮">🎮 Game Controller</option>
                                <option value="🎸">🎸 Guitar</option>
                                <option value="⚽">⚽ Soccer Ball</option>
                                <option value="🎬">🎬 Movie</option>
                                <option value="🍔">🍔 Burger</option>
                                <option value="🎨">🎨 Art Palette</option>
                                <option value="🚗">🚗 Car</option>
                                <option value="🏔️">🏔️ Mountain</option>
                                <option value="🌊">🌊 Ocean Wave</option>
                                <option value="🔥">🔥 Fire</option>
                                <option value="⭐">⭐ Star</option>
                            </select>
                        </div>
                        <small class="field-hint">Choose an icon that represents your group</small>
                    </div>

                    <div class="form-field">
                        <label for="editGroupName" class="form-label">Group Name *</label>
                        <input 
                            type="text" 
                            id="editGroupName"
                            class="form-input"
                            placeholder="My Awesome Group"
                            maxlength="50"
                            required
                        >
                        <small class="field-hint">Maximum 50 characters</small>
                    </div>

                    <div class="form-field full-width">
                        <label for="editGroupDescription" class="form-label">Description</label>
                        <textarea 
                            id="editGroupDescription"
                            class="form-input"
                            placeholder="Tell us about this group..."
                            rows="3"
                            maxlength="200"
                        ></textarea>
                        <small class="field-hint">Optional, maximum 200 characters</small>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeEditGroupModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        💾 Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Analytics Modal -->
    <div id="analyticsModal" class="modal" style="display: none;">
        <div class="modal-content modal-xlarge analytics-modal-modern">
            <div class="analytics-header">
                <div class="analytics-header-content">
                    <h2 data-i18n="app.analytics.title">📊 Group Analytics</h2>
                    <p class="analytics-subtitle" data-i18n="app.analytics.subtitle">Insights and trends for smarter expense management</p>
                </div>
                <button class="modal-close" onclick="closeAnalyticsModal()">&times;</button>
            </div>
            
            <div class="analytics-body">
                <!-- Period Selector -->
                <div class="analytics-period-selector">
                    <div class="period-tabs">
                        <button class="period-tab active" data-period="7" onclick="switchAnalyticsPeriod(7, this)">
                            <span class="period-label" data-i18n="app.analytics.periods.week">7 Days</span>
                        </button>
                        <button class="period-tab" data-period="30" onclick="switchAnalyticsPeriod(30, this)">
                            <span class="period-label" data-i18n="app.analytics.periods.month">30 Days</span>
                        </button>
                        <button class="period-tab" data-period="90" onclick="switchAnalyticsPeriod(90, this)">
                            <span class="period-label" data-i18n="app.analytics.periods.quarter">90 Days</span>
                        </button>
                        <button class="period-tab" data-period="all" onclick="switchAnalyticsPeriod('all', this)">
                            <span class="period-label" data-i18n="app.analytics.periods.all">All Time</span>
                        </button>
                    </div>
                    <div class="period-info">
                        <span class="period-icon">📅</span>
                        <span id="analyticsPeriodRange" class="period-range">Last 7 days</span>
                    </div>
                </div>

                <!-- Key Metrics Dashboard -->
                <div class="analytics-metrics-grid">
                    <!-- Total Spent Card -->
                    <div class="metric-card metric-primary">
                        <div class="metric-icon-container">
                            <div class="metric-icon">💰</div>
                        </div>
                        <div class="metric-content">
                            <div class="metric-label" data-i18n="app.analytics.metrics.totalSpent">Total Spent</div>
                            <div class="metric-value" id="analyticsTotalSpent">$0.00</div>
                            <div class="metric-trend" id="analyticsTotalTrend">
                                <span class="trend-indicator">―</span>
                                <span class="trend-text" data-i18n="app.analytics.metrics.noPrevious">No previous data</span>
                            </div>
                        </div>
                    </div>

                    <!-- Average Per Day Card -->
                    <div class="metric-card metric-success">
                        <div class="metric-icon-container">
                            <div class="metric-icon">📈</div>
                        </div>
                        <div class="metric-content">
                            <div class="metric-label" data-i18n="app.analytics.metrics.avgPerDay">Avg. per Day</div>
                            <div class="metric-value" id="analyticsAvgPerDay">$0.00</div>
                            <div class="metric-description" id="analyticsAvgDesc">
                                <span data-i18n="app.analytics.metrics.basedOn">Based on</span> <span id="analyticsActiveDays">0</span> <span data-i18n="app.analytics.metrics.activeDays">active days</span>
                            </div>
                        </div>
                    </div>

                    <!-- Total Transactions Card -->
                    <div class="metric-card metric-info">
                        <div class="metric-icon-container">
                            <div class="metric-icon">🧾</div>
                        </div>
                        <div class="metric-content">
                            <div class="metric-label" data-i18n="app.analytics.metrics.transactions">Transactions</div>
                            <div class="metric-value" id="analyticsTotalExpenses">0</div>
                            <div class="metric-description" id="analyticsAvgAmount">
                                <span data-i18n="app.analytics.metrics.avgAmount">Avg:</span> <span id="analyticsAvgAmountValue">$0.00</span>
                            </div>
                        </div>
                    </div>

                    <!-- Most Active Member Card -->
                    <div class="metric-card metric-warning">
                        <div class="metric-icon-container">
                            <div class="metric-icon">🏆</div>
                        </div>
                        <div class="metric-content">
                            <div class="metric-label" data-i18n="app.analytics.metrics.topContributor">Top Contributor</div>
                            <div class="metric-value metric-value-sm" id="analyticsTopMember">―</div>
                            <div class="metric-description" id="analyticsTopMemberDesc">
                                <span id="analyticsTopMemberCount">0</span> <span data-i18n="app.analytics.metrics.expenses">expenses</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Insights & Breakdowns -->
                <div class="analytics-content-grid">
                    <!-- Category Breakdown -->
                    <div class="analytics-panel">
                        <div class="panel-header">
                            <h3 class="panel-title">
                                <span class="panel-icon">📊</span>
                                <span data-i18n="app.analytics.panels.categories.title">Spending by Category</span>
                            </h3>
                            <div class="panel-subtitle" data-i18n="app.analytics.panels.categories.subtitle">Where your money goes</div>
                        </div>
                        <div class="panel-body">
                            <div id="analyticsCategoryBreakdown" class="category-breakdown">
                                <!-- Populated dynamically -->
                            </div>
                        </div>
                    </div>

                    <!-- Member Activity -->
                    <div class="analytics-panel">
                        <div class="panel-header">
                            <h3 class="panel-title">
                                <span class="panel-icon">👥</span>
                                <span data-i18n="app.analytics.panels.members.title">Member Activity</span>
                            </h3>
                            <div class="panel-subtitle" data-i18n="app.analytics.panels.members.subtitle">Who's paying what</div>
                        </div>
                        <div class="panel-body">
                            <div id="analyticsMemberBreakdown" class="member-breakdown">
                                <!-- Populated dynamically -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Spending Timeline -->
                <div class="analytics-panel analytics-panel-full">
                    <div class="panel-header">
                        <h3 class="panel-title">
                            <span class="panel-icon">📈</span>
                            <span data-i18n="app.analytics.panels.timeline.title">Spending Timeline</span>
                        </h3>
                        <div class="panel-subtitle" data-i18n="app.analytics.panels.timeline.subtitle">Daily expense trends</div>
                    </div>
                    <div class="panel-body">
                        <div id="analyticsTimelineChart" class="timeline-chart">
                            <!-- Populated dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Smart Insights -->
                <div class="analytics-insights">
                    <h3 class="insights-title">
                        <span class="insights-icon">💡</span>
                        <span data-i18n="app.analytics.insights.title">Smart Insights</span>
                    </h3>
                    <div id="analyticsSmartInsights" class="insights-grid">
                        <!-- Populated dynamically -->
                    </div>
                </div>

                <!-- Actions -->
                <div class="analytics-actions">
                    <button class="btn btn-secondary btn-analytics-export" onclick="exportAnalyticsToCSV()">
                        <span class="btn-icon">📥</span>
                        <span data-i18n="app.analytics.actions.exportCSV">Export to CSV</span>
                    </button>
                    <button class="btn btn-secondary btn-analytics-export" onclick="shareAnalytics()">
                        <span class="btn-icon">📤</span>
                        <span data-i18n="app.analytics.actions.share">Share Report</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Recurring Expense Details/Edit Modal -->
    <div id="recurringDetailsModal" class="modal" style="display: none;">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h2>🔄 Recurring Expense Details</h2>
                <button class="modal-close" onclick="closeRecurringDetailsModal()">&times;</button>
            </div>
            
            <div id="recurringDetailsContent" style="padding: 1.5rem;">
                <!-- Populated dynamically -->
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeRecurringDetailsModal()">
                    Close
                </button>
                <button type="button" class="btn btn-danger" onclick="confirmDeleteRecurring()">
                    🗑️ Delete
                </button>
            </div>
        </div>
    </div>

    <!-- Manage Recurring Expenses Modal (List View) -->
    <div id="manageRecurringModal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>🔄 Manage Recurring Expenses</h2>
                <button class="modal-close" onclick="closeManageRecurringModal()">&times;</button>
            </div>
            
            <div style="padding: 1.5rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <p style="color: rgba(255,255,255,0.7); margin: 0;">
                        View and manage all your recurring expenses. Click on any expense to see details and make changes.
                    </p>
                    <button class="btn btn-primary" onclick="closeManageRecurringModal(); showRecurringExpenseModal();">
                        ➕ Add New
                    </button>
                </div>
                
                <div id="manageRecurringList">
                    <!-- Populated dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- OpenAI Configuration Modal -->
    <div id="openaiConfigModal" class="modal" style="display: none;">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h2>🔑 Configure OpenAI API</h2>
                <button class="modal-close" onclick="closeOpenAIConfigModal()">&times;</button>
            </div>
            
            <div style="padding: 1.5rem;">
                <p style="color: rgba(255,255,255,0.8); margin-bottom: 1rem;">
                    To use receipt scanning, you need an OpenAI API key. Your key is stored locally and never shared.
                </p>
                
                <div class="form-field">
                    <label for="openaiApiKey" class="form-label">OpenAI API Key</label>
                    <input 
                        type="password" 
                        id="openaiApiKey"
                        class="form-input"
                        placeholder="sk-..."
                    >
                    <small class="field-hint">
                        Get your API key from <a href="https://platform.openai.com/api-keys" target="_blank" style="color: #667eea;">platform.openai.com</a>
                    </small>
                </div>
                
                <div style="background: rgba(102, 126, 234, 0.1); border-left: 3px solid #667eea; padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                    <strong style="color: #667eea;">💡 Tip:</strong>
                    <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; color: rgba(255,255,255,0.8);">
                        Each receipt scan costs approximately $0.01-0.03 USD. Your API key is stored in your browser's local storage.
                    </p>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeOpenAIConfigModal()">
                    Cancel
                </button>
                <button type="button" class="btn btn-primary" onclick="saveOpenAIConfig()">
                    💾 Save API Key
                </button>
            </div>
        </div>
    </div>

    <!-- Cookie Consent -->
    <script src="cookie-consent.js"></script>
    
    <!-- Analytics Events -->
    <script>
        // Track key user actions
        function trackEvent(eventName, eventParams = {}) {
            console.log(`[Analytics] Event: ${eventName}`, eventParams);
            
            // For conversion events, always attempt to send (first-party data)
            const conversionEvents = ['signup_complete', 'signin_complete', 'group_created', 'google_signup', 'google_signin'];
            const isConversion = conversionEvents.includes(eventName);
            
            if (typeof gtag !== 'undefined') {
                // Check cookie consent for non-conversion events
                if (isConversion || (window.CookieConsent && window.CookieConsent.isAnalyticsEnabled())) {
                    gtag('event', eventName, eventParams);
                    console.log(`[Analytics] Event sent: ${eventName}`);
                } else {
                    console.log(`[Analytics] Event blocked by consent: ${eventName}`);
                }
            } else {
                console.warn(`[Analytics] gtag not available for: ${eventName}`);
            }
        }
        
        // Track signup errors
        window.addEventListener('signupError', function(e) {
            trackEvent('signup_error', {
                'error_code': e.detail.error || 'unknown'
            });
        });
        
        // Track signin errors
        window.addEventListener('signinError', function(e) {
            trackEvent('signin_error', {
                'method': e.detail.method || 'unknown',
                'error_code': e.detail.error || 'unknown'
            });
        });
        
        // Track Google first-time signup (new user)
        window.addEventListener('signupComplete', function(e) {
            if (e.detail.method === 'google_signup') {
                console.log('[Analytics] Google FIRST-TIME signup detected');
                trackEvent('google_signup', {
                    'method': 'google_auth',
                    'user_type': 'new'
                });
            }
            // Also send the general signup_complete
            trackEvent('signup_complete', {
                'method': e.detail.method || 'unknown'
            });
        });
        
        // Track Google returning signin
        window.addEventListener('signinComplete', function(e) {
            if (e.detail.method === 'google_signin') {
                console.log('[Analytics] Google RETURNING user signin detected');
                trackEvent('google_signin', {
                    'method': 'google_auth',
                    'user_type': 'returning'
                });
            }
            // Also send the general signin_complete
            console.log('[Analytics] signinComplete event received', e.detail);
            trackEvent('signin_complete', {
                'method': e.detail.method || 'unknown'
            });
        });
        
        // Track group creation
        window.addEventListener('groupCreated', function(e) {
            trackEvent('group_created', {
                'group_type': e.detail.type || 'unknown'
            });
        });
        
        // Track expense added
        window.addEventListener('expenseAdded', function(e) {
            trackEvent('expense_added', {
                'amount_usd': e.detail.amount || 0
            });
        });
        
        // Track wallet connection
        window.addEventListener('walletConnected', function(e) {
            trackEvent('wallet_connected', {
                'wallet_type': e.detail.wallet || 'unknown'
            });
        });
    </script>

    <!-- Service Worker Registration & PWA Install -->
    <script>
        // PWA Install Prompt
        let deferredPrompt;
        let installPromptDismissed = localStorage.getItem('pwaInstallDismissed') === 'true';

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install prompt if not dismissed
            if (!installPromptDismissed) {
                const promptEl = document.getElementById('pwaInstallPrompt');
                if (promptEl) {
                    promptEl.style.display = 'block';
                    setTimeout(() => promptEl.classList.add('show'), 100);
                }
            }
        });

        // Install button click
        document.addEventListener('DOMContentLoaded', () => {
            const installBtn = document.getElementById('installPWAButton');
            const dismissBtn = document.getElementById('dismissPWAPrompt');
            const promptEl = document.getElementById('pwaInstallPrompt');

            if (installBtn) {
                installBtn.addEventListener('click', async () => {
                    if (!deferredPrompt) return;
                    
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    
                    if (outcome === 'accepted') {
                        console.log('✅ PWA installed');
                        showToast('App installed successfully! 🎉', 'success');
                    }
                    
                    deferredPrompt = null;
                    promptEl.style.display = 'none';
                });
            }

            if (dismissBtn) {
                dismissBtn.addEventListener('click', () => {
                    promptEl.classList.remove('show');
                    setTimeout(() => {
                        promptEl.style.display = 'none';
                    }, 300);
                    localStorage.setItem('pwaInstallDismissed', 'true');
                    installPromptDismissed = true;
                });
            }
        });

        // Service Worker Registration with visual feedback
        if ('serviceWorker' in navigator) {
            let swInstalling = false;
            
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(reg => {
                        // Show installing message
                        if (reg.installing) {
                            swInstalling = true;
                            showToast('Installing app for offline use... 📦', 'info', 0);
                        } else if (reg.active) {
                            // Already installed and active
                            // showOfflineReadyIndicator();
                        }
                        
                        // Listen for Service Worker state changes
                        reg.addEventListener('updatefound', () => {
                            const newWorker = reg.installing;
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed') {
                                    if (navigator.serviceWorker.controller) {
                                        // Update available
                                        showToast('New version available! Refresh to update. 🔄', 'info', 0);
                                    } else {
                                        // First install
                                        if (swInstalling) {
                                            // Hide installing toast
                                            const toasts = document.querySelectorAll('.toast');
                                            toasts.forEach(toast => {
                                                if (toast.textContent.includes('Installing')) {
                                                    toast.remove();
                                                }
                                            });
                                        }
                                        // showToast('App installed! Ready for offline use ✓', 'success');
                                        // showOfflineReadyIndicator();
                                    }
                                }
                                
                                if (newWorker.state === 'activated') {
                                    // Service Worker activated
                                }
                            });
                        });
                    })
                    .catch(err => {
                        console.error('❌ Service Worker registration failed:', err);
                        showToast('Offline mode unavailable', 'error');
                    });
                
                // Listen for controller change (new SW activated)
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    // New Service Worker activated
                });
            });
        }

        // Show offline-ready indicator
        function showOfflineReadyIndicator() {
            const indicator = document.getElementById('offlineReadyIndicator');
            if (indicator) {
                indicator.style.display = 'block';
                setTimeout(() => indicator.classList.add('show'), 100);
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    indicator.classList.remove('show');
                    setTimeout(() => {
                        indicator.style.display = 'none';
                    }, 300);
                }, 5000);
            }
        }

        // Online/Offline status
        window.addEventListener('online', () => {
            showToast('Back online! 🌐', 'success');
        });

        window.addEventListener('offline', () => {
            showToast('You\'re offline. Using cached version 📴', 'warning', 0);
        });
    </script>

    <!-- Challenge Mode Modal -->
    <div id="challengeModeModal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>🎮 Challenge Mode</h2>
                <button class="modal-close" onclick="closeChallengeModal()">&times;</button>
            </div>
            
            <div class="modal-body">
            <!-- Step 1: Mode Selection -->
            <div id="challengeModeSelection" class="challenge-step">
                <div class="challenge-intro">
                    <h3>Who will pay?</h3>
                    <p>Make it fun! Choose how to decide who pays for this expense.</p>
                </div>
                
                <div class="mode-options">
                    <div class="mode-card" onclick="selectChallengeMode('physical')">
                        <div class="mode-icon">🎯</div>
                        <h4>We're Together</h4>
                        <p>Play mini-games by passing the phone around</p>
                        <div class="mode-badge">Interactive Games</div>
                    </div>
                    
                    <div class="mode-card" onclick="selectChallengeMode('remote')">
                        <div class="mode-icon">🎲</div>
                        <h4>We're Apart</h4>
                        <p>Automatic selection methods</p>
                        <div class="mode-badge">Quick & Easy</div>
                    </div>
                </div>
            </div>
            
            <!-- Step 1.5: Player Selection -->
            <div id="playerSelection" class="challenge-step" style="display: none;">
                <div class="challenge-intro">
                    <button class="btn-back" onclick="backToModeSelection()">← Back</button>
                    <h3>Select Players</h3>
                    <p>Choose who will participate (minimum 2 players)</p>
                </div>
                
                <div class="player-selection-controls">
                    <button class="btn-select-all" onclick="toggleSelectAllPlayers()">
                        <span id="selectAllIcon">☑️</span>
                        <span id="selectAllText">Select All</span>
                    </button>
                    <div class="selected-count">
                        <span id="selectedPlayerCount">0</span> players selected
                    </div>
                </div>
                
                <div id="playerSelectionList" class="player-selection-list">
                    <!-- Player checkboxes will be inserted here -->
                </div>
                
                <div class="player-selection-footer">
                    <button id="confirmPlayersBtn" class="btn-primary" onclick="confirmPlayerSelection()" disabled>
                        Continue
                    </button>
                </div>
            </div>
            
            <!-- Step 2a: Game Selection (Physical Mode) -->
            <div id="gameSelection" class="challenge-step" style="display: none;">
                <div class="challenge-intro">
                    <button class="btn-back" onclick="resetChallengeState()">← Back</button>
                    <h3>Choose Your Game</h3>
                    <p>Everyone will play - the loser pays!</p>
                </div>
                
                <div class="game-grid">
                    <div class="game-card" onclick="selectGame('quickTap')">
                        <div class="game-icon">⚡🐜</div>
                        <h4>Quick Tap</h4>
                        <p>React faster than a worker ant!</p>
                        <div class="game-difficulty easy">EASY</div>
                    </div>
                    
                    <div class="game-card" onclick="selectGame('numberGuess')">
                        <div class="game-icon">🎯🐜</div>
                        <h4>Number Guess</h4>
                        <p>Find the food like a scout ant!</p>
                        <div class="game-difficulty medium">MEDIUM</div>
                    </div>
                    
                    <div class="game-card" onclick="selectGame('colorMatch')">
                        <div class="game-icon">🎨🐜</div>
                        <h4>Color Match</h4>
                        <p>Match colors like ant pheromones!</p>
                        <div class="game-difficulty medium">MEDIUM</div>
                    </div>
                    
                    <div class="game-card" onclick="selectGame('shakeIt')">
                        <div class="game-icon">📳🐜</div>
                        <h4>Shake It!</h4>
                        <p>Shake like ants carrying food!</p>
                        <div class="game-difficulty fun">FUN</div>
                    </div>
                    
                    <div class="game-card" onclick="selectGame('memoryCards')">
                        <div class="game-icon">🧠🐜</div>
                        <h4>Memory Cards</h4>
                        <p>Navigate tunnels like colony ants!</p>
                        <div class="game-difficulty hard">HARD</div>
                    </div>
                    
                    <div class="game-card" onclick="selectGame('mathChallenge')">
                        <div class="game-icon">🔢🐜</div>
                        <h4>Math Challenge</h4>
                        <p>Calculate like the ant queen!</p>
                        <div class="game-difficulty hard">HARD</div>
                    </div>
                    
                    <div class="game-card" onclick="selectGame('aiTrivia')">
                        <div class="game-icon">🤖🐜</div>
                        <h4>AI Trivia</h4>
                        <p>Colony knowledge challenge!</p>
                        <div class="game-difficulty special">AI POWERED</div>
                        <small style="color: #888; font-size: 0.75rem; margin-top: 0.25rem;">⚠️ Requires OpenAI API key</small>
                    </div>
                </div>
            </div>
            
            <!-- Step 2b: Remote Selection Options -->
            <div id="remoteSelection" class="challenge-step" style="display: none;">
                <div class="challenge-intro">
                    <button class="btn-back" onclick="resetChallengeState()">← Back</button>
                    <h3>Selection Method</h3>
                    <p>How should we choose who pays?</p>
                </div>
                
                <div class="remote-options">
                    <div class="remote-card" onclick="selectRemoteMethod('random')">
                        <div class="remote-icon">🎰</div>
                        <h4>Random Spin</h4>
                        <p>Everyone has equal chance</p>
                        <small style="color: #888; margin-top: 0.5rem; display: block;">Classic spin the wheel - completely random selection with no bias. Most transparent and fun!</small>
                        <div class="remote-badge">Most Fair</div>
                    </div>
                    
                    <div class="remote-card" onclick="selectRemoteMethod('fair')">
                        <div class="remote-icon">⚖️</div>
                        <h4>Fair Rotation</h4>
                        <p>Tracks who paid last</p>
                        <small style="color: #888; margin-top: 0.5rem; display: block;">Automatically selects the person who has paid the fewest times recently. Ensures everyone contributes equally over time.</small>
                        <div class="remote-badge">Balanced</div>
                    </div>
                    
                    <div class="remote-card" onclick="selectRemoteMethod('balance')">
                        <div class="remote-icon">💰</div>
                        <h4>By Balance</h4>
                        <p>Who owes the most pays</p>
                        <small style="color: #888; margin-top: 0.5rem; display: block;">Selects based on current group balances. Person who has contributed least (or owes most) gets selected.</small>
                        <div class="remote-badge">Smart</div>
                    </div>
                    
                    <div class="remote-card" onclick="selectRemoteMethod('dice')">
                        <div class="remote-icon">🎲</div>
                        <h4>Dice Battle</h4>
                        <p>Everyone rolls, lowest loses</p>
                        <small style="color: #888; margin-top: 0.5rem; display: block;">Each member rolls virtual dice. The person with the lowest roll pays. Fun and dramatic with 3D dice animation!</small>
                        <div class="remote-badge">Fun</div>
                    </div>
                    
                    <div class="remote-card" onclick="selectRemoteMethod('cards')">
                        <div class="remote-icon">🎴</div>
                        <h4>Card Draw</h4>
                        <p>Lowest card pays</p>
                        <small style="color: #888; margin-top: 0.5rem; display: block;">Everyone draws a card from the deck. Person with the lowest card gets selected. Classic and elegant!</small>
                        <div class="remote-badge">Classic</div>
                    </div>
                    
                    <div class="remote-card" onclick="selectRemoteMethod('antPool')">
                        <div class="remote-icon">🐜</div>
                        <h4>Ant Pool Roulette</h4>
                        <p>Colony intelligence decides!</p>
                        <small style="color: #888; margin-top: 0.5rem; display: block;">The ant colony analyzes who spent less, created fewer transactions, device owner, and other metadata. Random criterion selection like nature's wisdom!</small>
                        <div class="remote-badge">🐜 Colony AI</div>
                    </div>
                </div>
            </div>
            
            <!-- Step 3: Game Play Area -->
            <div id="gamePlay" class="challenge-step" style="display: none;">
                <div id="gamePlayArea">
                    <!-- Game content will be dynamically inserted here -->
                </div>
            </div>
            </div><!-- End modal-body -->
        </div>
    </div>

    <!-- Load Challenge Games Script -->
    <script src="challenge-games.js"></script>

</body>
</html>
